var pxt;!function(e){var n,t;n=e.py||(e.py={}),(t=n.VarModifier||(n.VarModifier={}))[t.NonLocal=0]="NonLocal",t[t.Global=1]="Global"}(pxt||(pxt={})),function($e){!function(D){var R,M,b,B,q,G,z,Q=$e.blocks,x=0,t=0,W=0,s="???",r=!1,u=void 0,j=void 0;function o(e){return null==e}function f(e){return null!=e}function p(e){return $e.tickEvent("python.todo",{kind:e.kind}),Q.mkStmt(Q.mkText("TODO: "+e.kind))}function i(e){return $e.tickEvent("python.todo",{kind:e.kind}),Q.mkText(" {TODO: "+e.kind+"} ")}var a=k({primType:"string"}),l=k({primType:"number"}),c=k({primType:"boolean"}),m=k({primType:"void"}),d=k({primType:"any"}),V=void 0,y={string:a,number:l,boolean:c,void:m,any:d};function $(e){var n=$e.U.flatClone(e);return delete n.pyAST,delete n.pyInstanceType,delete n.pyRetType,delete n.pySymbolType,delete n.moduleTypeMarker,delete n.declared,n.parameters&&(n.parameters=n.parameters.map(function(e){return delete(e=$e.U.flatClone(e)).pyType,e})),n}function H(e){if("("==e[0]&&$e.U.endsWith(e,")"))return H(e.slice(1,-1));var n=e.indexOf(" => ");if(0<n){var t=e.slice(n+4);if(-1==t.indexOf(")[]")){var r=H(t),i=e.slice(1,n-1);return h(r,(i?i.split(/, /):[]).map(function(e){return H(e.replace(/\w+\??: /,""))}))}}if($e.U.endsWith(e,"[]"))return g(H(e.slice(0,-2)));if("_py.Array"===e)return g(d);var a=$e.U.lookup(y,e);if(a)return a;if(!!e&&!isNaN(e))return l;if("T"==e||"U"==e)return k({primType:"'"+e});var o=v(e+"@type")||v(e);return o?7==o.kind?l:8==o.kind||9==o.kind?o.pyInstanceType||k({classType:o}):6==o.kind?l:(J(null,9502,$e.U.lf("'{0}' is not a type near '{1}'",e,s||"???")),k({primType:e})):(J(null,9501,$e.U.lf("unknown type '{0}' near '{1}'",e,s||"???")),k({primType:e}))}function N(e){return e.attributes.shim&&"@"==e.attributes.shim[0]}function T(e){if(!e.pySymbolType){if(s=e.pyQName,e.parameters){N(e)&&(e.parameters=[{name:"literal",description:"",type:"string",options:{}}]);for(var n=0,t=e.parameters;n<t.length;n++){var r=t[n];r.pyType||(r.pyType=H(r.type))}}var i=e.pyRetType;if(le(e)?e.pyRetType=k({moduleType:e}):e.retType?e.pyRetType=H(e.retType):e.pyRetType||($e.U.oops("no type for: "+e.pyQName),e.pyRetType=k({})),i&&X(e.pyAST,i,e.pyRetType),3==e.kind||1==e.kind){var a=e.parameters.map(function(e){return e.pyType});if(a.some(o))return J(null,9526,$e.U.lf("function symbol is missing parameter types near '{1}'",s||"???")),k({});e.pySymbolType=h(e.pyRetType,a.filter(f))}else e.pySymbolType=e.pyRetType;8!=e.kind&&9!=e.kind||(e.pyInstanceType=k({classType:e})),s=void 0}return e.pySymbolType}function v(e){return $e.U.lookup(M,e)||$e.U.lookup(R,e)}function E(e){if(e){var n=v(e);return n&&T(n),n}}function k(e){void 0===e&&(e={});var n=$e.U.flatClone(e);return n.tid=++t,n}function g(e){return k({primType:"@array",typeArgs:[e]})}function h(e,n){return k({primType:"@fn"+n.length,typeArgs:[e].concat(n)})}function C(){return b.currFun||b.currClass||b.currModule}function S(){for(var e=C();e&&e.parent;)e=e.parent;return e}function U(){return"main"==b.currModule.name&&!b.currFun&&!b.currClass}function I(e,n,t){t||(t=C());var r=t.vars[e];if(!r){var i=A(t);i&&(i+=".");var a=i+e;r=ee(t)?Y(4,e):Z(4,a),t.vars[e]=r}for(var o=0,s=Object.keys(n);o<s.length;o++){var u=s[o];r[u]=n[u]}return r}function w(e){return e.union?(e.union=w(e.union),e.union):e}function A(e){var n=e,t="";n.parent&&"FunctionDef"!==n.parent.kind&&"AsyncFunctionDef"!==n.parent.kind&&((t=A(n.parent))?t+=".":t="");var r=e;return"Module"==e.kind&&"main"==r.name?"":r.name?t+r.name:t+"?"+e.kind}function P(e){var n=$e.U.lookup(ke,e);if(n)return n;for(var t=0,r=$e.U.values(b.currModule.vars);t<r.length;t++){var i=r[t];if(i.isImport){if(i.expandsTo==e)return i.pyName||J(null,9553,lf("missing pyName")),i.pyName;if(i.isImport&&$e.U.startsWith(e,(i.expandsTo||"")+"."))return i.pyName+e.slice(i.expandsTo.length)}}return e}function _(e){var n=function(e){return r?e:""};return(e=w(e)).primType?e.typeArgs&&"@array"==e.primType?_(e.typeArgs[0])+"[]":$e.U.startsWith(e.primType,"@fn")&&e.typeArgs?"("+e.typeArgs.slice(1).map(function(e){return"_: "+_(e)}).join(", ")+") => "+_(e.typeArgs[0]):e.primType+n("/P"):e.classType&&e.classType.pyQName?P(e.classType.pyQName)+n("/C"):e.moduleType&&e.moduleType.pyQName?P(e.moduleType.pyQName)+n("/M"):"?"+e.tid}function J(e,n,t){var r,i,a,o;q.push((r=e,i=pxtc.DiagnosticCategory.Error,a=n,o=t,r||(r=u),r&&b&&b.currModule?{fileName:B,start:r.startPos,length:r.endPos-r.startPos,line:void 0,column:void 0,code:a,category:i,messageText:o}:{fileName:B,start:0,length:0,line:void 0,column:void 0,code:a,category:i,messageText:o}))}function K(e){return e.primType?e.primType:e.classType?e.classType:e.moduleType?(e.moduleType.moduleTypeMarker||(e.moduleType.moduleTypeMarker={}),e.moduleType.moduleTypeMarker):null}function L(e){return!K(w(e))}function F(e,n,t){var r;(n=w(n)).classType!=t&&(L(n)?n.classType=t:X(e,n,(T(r=t),r.pyInstanceType||J(null,9527,$e.U.lf("Instance type symbol '{0}' is missing pyInstanceType",r)),r.pyInstanceType)))}function O(e,n){X(e,ue(e),n)}function X(e,n,t){if(n!==t&&(n=w(n))!==(t=w(t)))if("any"!==n.primType){var r,i,a=K(n),o=K(t);if(a&&o)if(a===o){if(n.union=t,n.typeArgs&&t.typeArgs)for(var s=0;s<Math.min(n.typeArgs.length,t.typeArgs.length);++s)X(e,n.typeArgs[s],t.typeArgs[s]);n.union=t}else r=n,i=t,J(e,9500,$e.U.lf("types not compatible: {0} and {1}",_(r),_(i)));else a&&!o?X(e,t,n):(W++,n.union=t)}else n.union=t}function Y(e,n){var t=/(.*)\.(.*)/.exec(n),r=t?t[2]:n;return{kind:e,name:r,pyName:r,qName:n,pyQName:n,namespace:t?t[1]:"",attributes:{},pyRetType:k()}}function Z(e,n){var t=M[n];return t?(t.kind=e,t):((t=Y(e,n)).pyQName||J(null,9527,$e.U.lf("Symbol '{0}' is missing pyQName",n)),M[t.pyQName]=t)}function ee(e){for(var n=e;n;){if("FunctionDef"==n.kind)return!0;n=n.parent}return!1}function ne(e,n,t){if(!n.symInfo){var r=A(n);$e.U.endsWith(r,".__init__")&&(r=r.slice(0,-9)+".__constructor"),ee(t=t||C())?n.symInfo=Y(e,r):n.symInfo=Z(e,r);var i=n.symInfo;i.pyAST=n,i.pyName||J(null,9528,$e.U.lf("Symbol '{0}' is missing pyName",i.qName||i.name)),t.vars[i.pyName]=i}return n.symInfo}function te(e){var n=e.symInfo.qName;return $e.U.values(M).filter(function(e){return e.namespace==n&&2==e.kind})}function re(e,n,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var i=e.pyQName+"."+n,a=E(i);if(a)return a;if(!r)for(var o=0,s=e.extendsTypes||[];o<s.length;o++){var u;if(u=E(s[o])){u==e&&$e.U.userError("field lookup loop on: "+u.qName+" / "+n);var l=re(u,n,!0);if(l)return l}}return!t&&e.pyAST&&"ClassDef"==e.pyAST.kind?((u=Z(2,i)).isInstance=!0,u):null}function ie(e,n,t){void 0===t&&(t=!1);for(var r,i,a,o=ue(e),s=0,u=[(r=w(o)).classType].concat(ae(r.primType),[r.moduleType]).filter(f);s<u.length;s++){var l=u[s],c=re(l,n,t);if(c)return!!l.moduleTypeMarker?c.isInstance&&J(null,9505,$e.U.lf("the field '{0}' of '{1}' is not static",n,l.pyQName)):(c.isInstance||J(null,9504,$e.U.lf("the field '{0}' of '{1}' is static",n,l.pyQName)),Ie(a=e,"super")&&0==a.args.length?c.isProtected=!0:"Name"==(i=e).kind&&"self"==i.id&&(b.currClass||J(null,9529,$e.U.lf("no class context found for {0}",c.pyQName)),c.namespace!=b.currClass.symInfo.qName&&(c.isProtected=!0))),c}return null}function ae(e){var n=[];return"@array"==e?n=[v("_py.Array"),v("Array")]:"string"==e&&(n=[v("_py.String"),v("String")]),n.filter(function(e){return!!e})}function oe(e){var n=C(),t=$e.U.lookup(n.vars,e);return t||null}function se(e){if(!e)return null;var n,t=e.indexOf(".");if(0<t)(n=oe(e.slice(0,t)))&&n.pyQName!=n.pyName&&(e=n.pyQName+e.slice(t));else if(n=oe(e))return n;return E(e)}function ue(e){return e.tsType?w(e.tsType):(e.tsType=k(),e.tsType)}function le(e){if(!e)return!1;switch(e.kind){case 5:case 9:case 8:case 6:return!0;default:return!1}}function ce(e){var n,t=$e.U.flatClone(b);try{n=e()}finally{b=t}return n}function fe(e,n){return 0==n.length?Q.mkText(""):Q.mkGroup([Q.mkText("/* TODO: "+e+" "),Q.mkGroup(n),Q.mkText(" */"),Q.mkNewLine()])}function pe(e){var n=Be(e.value);return e.arg?Q.mkInfix(Q.mkText(e.arg),"=",n):Q.mkGroup([Q.mkText("**"),n])}function me(e){if(!e)return k();var n=Ce(e);if(n){var t=v(n+"@type")||v(n);if(t){if(T(t),6==t.kind)return l;if(t.pyInstanceType)return t.pyInstanceType}else if(y[n])return y[n];J(e,9506,$e.U.lf("cannot find type '{0}'",n))}return J(e,9507,$e.U.lf("invalid type syntax")),k({})}var de={Sub:1,Div:1,Pow:1,LShift:1,RShift:1,BitOr:1,BitXor:1,BitAnd:1,FloorDiv:1,Mult:1},ye={Add:"+",Sub:"-",Mult:"*",MatMult:"Math.matrixMult",Div:"/",Mod:"%",Pow:"**",LShift:"<<",RShift:">>",BitOr:"|",BitXor:"^",BitAnd:"&",FloorDiv:"Math.idiv",And:"&&",Or:"||",Eq:"==",NotEq:"!=",Lt:"<",LtE:"<=",Gt:">",GtE:">=",Is:"===",IsNot:"!==",In:"py.In",NotIn:"py.NotIn"},ve={Invert:"~",Not:"!",UAdd:"P+",USub:"P-"},ke={"adafruit_bus_device.i2c_device.I2CDevice":"pins.I2CDevice"};function ge(e){b.blockDepth++;var n=Q.mkBlock(e.map(qe));return b.blockDepth--,n}function xe(e){e.vars||(e.vars={},e.parent=C(),e.blockDepth=b.blockDepth)}function Te(e,n){return void 0===n&&(n=!1),"?"==_(e)[0]?n?Q.mkText(": any"):Q.mkText(""):Q.mkText(": "+_(e))}function e(n,e){try{return ce(e)}catch(e){return console.log(e),Q.mkStmt(fe("conversion failed for "+(n.name||n.kind),[]))}}function he(e){if(!e||!e.pyAST)return!1;if("FunctionDef"!=e.pyAST.kind)return!1;var n=e.pyAST;return!(!n.callers||1!=n.callers.length)&&!n.callers[0].inCalledPosition}function Se(k,g){return void 0===g&&(g=!1),e(k,function(){var e=!!b.currClass&&!b.currFun,n=U(),t=!!b.currFun;xe(k);var r=se(A(k)),i=ne(e?1:3,k);if(!g&&(r&&r.declared===x&&J(k,9520,lf("Duplicate function declaration")),i.declared=x,he(i)))return Q.mkText("");e&&(i.isInstance=!0),b.currFun=k;var a="",o=k.name,s=[fe("decorators",k.decorator_list.filter(function(e){return"property"==Ce(e)?!(a="get"):"Attribute"!=e.kind||"setter"!=e.attr||"Name"!=e.value.kind||(o=e.value.id,!(a="set"))}).map(Be))];if(1<=k.body.length&&"Raise"==k.body[0].kind&&(k.alwaysThrows=!0),e)if(b.currClass||J(k,9531,lf("method '{0}' is missing current class context",i.pyQName)),i.pyRetType||J(k,9532,lf("method '{0}' is missing a return type",i.pyQName)),"__init__"==k.name)s.push(Q.mkText("constructor")),F(k,i.pyRetType,b.currClass.symInfo);else{if("__get__"==o||"__set__"==o){var u=k.vars.value;if("__set__"==o&&u){var l=re(b.currClass.symInfo,"__get__");l&&l.pyAST&&"FunctionDef"==l.pyAST.kind&&X(k,u.pyRetType,l.pyRetType)}o=o.replace(/_/g,"")}a||(a="_"==o[0]?i.isProtected?"protected":"private":"public"),s.push(Q.mkText(a+" "),Ue(o))}else $e.U.assert(!a),"_"==k.name[0]||n||g||t?s.push(Q.mkText("function "),Ue(o)):s.push(Q.mkText("export function "),Ue(o));s.push(function(r,e){var i=r.args;i.kwonlyargs.length&&J(r,9517,$e.U.lf("keyword-only arguments not supported yet"));var n=i.args.slice();if(e?("self"!=n[0].arg&&J(r,9518,$e.U.lf("first argument of method has to be called 'self'")),n.shift()):n.some(function(e){return"self"==e.arg})&&J(r,9519,$e.U.lf("non-methods cannot have an argument called 'self'")),!r.symInfo.parameters){var a=i.defaults.length-n.length;r.symInfo.parameters=n.map(function(e){e.annotation||J(r,9519,$e.U.lf("Arg '{0}' missing annotation",e.arg));var n=me(e.annotation),t="";return 0<=a&&(t=Q.flattenNode([Be(i.defaults[a])]).output,X(e,n,ue(i.defaults[a]))),a++,{name:e.arg,description:"",type:"",initializer:t,default:t,pyType:n}})}var t=r.symInfo.parameters.map(function(e){var n=I(e.name,{isParam:!0});e.pyType||J(r,9530,$e.U.lf("parameter '{0}' missing pyType",e.name)),X(r,T(n),e.pyType);var t=[Ue(e.name),Te(e.pyType,!0)];return e.default&&t.push(Q.mkText(" = "+e.default)),Q.mkGroup(t)});return i.vararg&&t.push(Q.mkText("TODO *"+i.vararg.arg)),i.kwarg&&t.push(Q.mkText("TODO **"+i.kwarg.arg)),Q.H.mkParenthesizedExpression(Q.mkCommaSep(t))}(k,e),k.returns?Te(me(k.returns)):Q.mkText("")),T(i);var c=k.body.map(qe);if("__init__"==k.name){b.currClass||J(k,9533,lf("__init__ method '{0}' is missing current class context",i.pyQName));for(var f=0,p=te(b.currClass);f<p.length;f++){var m=p[f],d=m.pyAST;d&&d.value&&c.push(Q.mkStmt(Q.mkText("this."+Ee(m.pyName)+" = "),Be(d.value)))}}var y=Qe(k);s.push(Q.mkBlock(y.concat(c)));var v=Q.mkGroup(s);return g?s[s.length-1].noFinalNewline=!0:v=Q.mkStmt(v),v})}var be={FunctionDef:function(e){return Se(e)},ClassDef:function(u){return e(u,function(){xe(u);var e=ne(8,u);$e.U.assert(!b.currClass);var n=U();(b.currClass=u).isNamespace=u.decorator_list.some(function(e){return"Name"==e.kind&&"namespace"==e.id});var t,r,i=u.isNamespace?[Q.mkText("namespace "),Ue(u.name)]:[fe("keywords",u.keywords.map(pe)),fe("decorators",u.decorator_list.map(Be)),Q.mkText(n?"class ":"export class "),Ue(u.name)];if(!u.isNamespace&&0<u.bases.length)if("Enum"==Ce(u.bases[0]))u.isEnum=!0;else{i.push(Q.mkText(" extends ")),i.push(Q.mkCommaSep(u.bases.map(Be)));var a=(t=u.bases[0],(r=se(Ce(t)))&&r.pyAST&&"ClassDef"==r.pyAST.kind?r.pyAST:null);a&&(u.baseClass=a,e.extendsTypes=[a.symInfo.pyQName])}var o=ge(u.body);i.push(o);var s=te(u).filter(function(e){return 2==e.kind&&e.isInstance}).map(function(e){return e.pyName&&e.pyRetType||J(u,9535,lf("field definition missing py name or ret type",e.qName)),e}).map(function(e){return Q.mkStmt((n=e).pyName&&"_"==n.pyName[0]?n.isProtected?Q.mkText("protected "):Q.mkText("private "):Q.mkText(""),Ue(e.pyName),Te(e.pyRetType));var n});return o.children=s.concat(o.children),Q.mkStmt(Q.mkGroup(i))})},Return:function(e){if(e.value){var n=b.currFun;return n&&(n.symInfo.pyRetType||J(e,9536,lf("function '{0}' missing return type",n.symInfo.pyQName)),O(e.value,n.symInfo.pyRetType)),Q.mkStmt(Q.mkText("return "),Be(e.value))}return Q.mkStmt(Q.mkText("return"))},AugAssign:function(e){var n=ye[e.op];return 3<n.length?Q.mkStmt(Q.mkInfix(Be(e.target),"=",Q.H.mkCall(n,[Be(e.target),Be(e.value)]))):Q.mkStmt(Be(e.target),Q.mkText(" "+n+"= "),Be(e.value))},Assign:function(e){return n(e)},AnnAssign:function(e){return n(e)},For:function(e){if($e.U.assert(0==e.orelse.length),Ie(e.iter,"range")){var n=e.iter,t=Be(e.target),r=Ue(Ce(e.target));O(e.target,l);var i=1==n.args.length?Q.mkText("0"):Be(n.args[0]),a=Be(n.args[1==n.args.length?0:1]);return Q.mkStmt(Q.mkText("for ("),Q.mkInfix(t,"=",i),Q.mkText("; "),Q.mkInfix(r,"<",a),Q.mkText("; "),3<=n.args.length?Q.mkInfix(r,"+=",Be(n.args[2])):Q.mkPostfix([r],"++"),Q.mkText(")"),ge(e.body))}return O(e.iter,g(ue(e.target))),Q.mkStmt(Q.mkText("for ("),Be(e.target),Q.mkText(" of "),Be(e.iter),Q.mkText(")"),ge(e.body))},While:function(e){return $e.U.assert(0==e.orelse.length),Q.mkStmt(Q.mkText("while ("),Be(e.test),Q.mkText(")"),ge(e.body))},If:function(e){var t=function(e){var n=[Q.mkText("if ("),Be(e.test),Q.mkText(")"),ge(e.body)];return e.orelse.length&&(n[n.length-1].noFinalNewline=!0,1==e.orelse.length&&"If"==e.orelse[0].kind?(n.push(Q.mkText(" else ")),$e.U.pushRange(n,t(e.orelse[0]))):n.push(Q.mkText(" else"),ge(e.orelse))),n};return Q.mkStmt(Q.mkGroup(t(e)))},With:function(e){if(1==e.items.length&&(o=e.items[0].context_expr,s="pins.I2CDevice",(u=ue(o)).classType&&u.classType.pyQName==s||_(u)==s)){var n=e.items[0],t=[],r=Be(n.context_expr);if(n.optional_vars){var i=Ce(n.optional_vars);if(i){var a=I(i,{isLocal:!0});i=Ee(i),t.push(Q.mkStmt(Q.mkText("const "+i+" = "),r)),a.pyRetType||J(e,9537,lf("function '{0}' missing return type",a.pyQName)),O(n.context_expr,a.pyRetType),r=Q.mkText(i)}}return t.push(Q.mkStmt(Q.mkInfix(r,".",Q.mkText("begin()")))),$e.U.pushRange(t,e.body.map(qe)),t.push(Q.mkStmt(Q.mkInfix(r,".",Q.mkText("end()")))),Q.mkGroup(t)}var o,s,u,l=[],c=e.items.map(function(e,n){var t="with"+n;if(e.optional_vars){var r=Ce(e.optional_vars);$e.U.assert(null!=r),I(r,{isLocal:!0}),t=Ee(r)}return l.push(Q.mkStmt(Q.mkText(t+".end()"))),Q.mkStmt(Q.mkText("const "+t+" = "),Q.mkInfix(Be(e.context_expr),".",Q.mkText("begin()")))});return $e.U.pushRange(c,e.body.map(qe)),$e.U.pushRange(c,l),Q.mkBlock(c)},Raise:function(e){var n=e.exc||e.cause;if(!n)return Q.mkStmt(Q.mkText("throw"));var t=void 0;if(n&&"Call"==n.kind){var r=n;1==r.args.length&&(t=Be(r.args[0]))}return t||(t=Q.mkGroup([Q.mkText("`"),Be(n),Q.mkText("`")])),Q.mkStmt(Q.H.mkCall("control.fail",[t]))},Assert:function(e){return e.msg||J(e,9537,lf("assert missing message")),Q.mkStmt(Q.H.mkCall("control.assert",[e.test,e.msg].filter(function(e){return!!e}).map(Be)))},Import:function(e){for(var n=0,t=e.names;n<t.length;n++){var r=t[n];r.asname&&I(r.asname,{expandsTo:r.name}),i=e,a=r.name,void 0,E(a)||J(i,9503,$e.U.lf("No module named '{0}'",a))}var i,a;return Q.mkText("")},ImportFrom:function(e){for(var n=[],t=0,r=e.names;t<r.length;t++){var i=r[t];if("*"==i.name)e.module||J(e,9538,lf("import missing module name")),I(e.module,{isImportStar:!0});else{var a=e.module+"."+i.name,o=E(a),s=i.asname||i.name;le(o)?(I(s,{isImport:o,expandsTo:a}),n.push(Q.mkStmt(Q.mkText("import "+Ee(s)+" = "+a)))):I(s,{expandsTo:a})}}return Q.mkGroup(n)},ExprStmt:function(e){return"Str"==e.value.kind?((n=e.value.s).trim().split(/\n/).length<=1?n=n.trim():n+="\n",Q.mkStmt(Q.mkText("/** "+n+" */"))):Q.mkStmt(Be(e.value));var n},Pass:function(e){return Q.mkStmt(Q.mkText(""))},Break:function(e){return Q.mkStmt(Q.mkText("break"))},Continue:function(e){return Q.mkStmt(Q.mkText("continue"))},Delete:function(e){return J(e,9550,$e.U.lf("delete statements are unsupported")),p(e)},Try:function(e){for(var n=[Q.mkText("try"),ge(e.body.concat(e.orelse))],t=0,r=e.handlers;t<r.length;t++){var i=r[t];n.push(Q.mkText("catch ("),i.name?Ue(i.name):Q.mkText("_")),i.type&&n.push(Q.mkText("/* instanceof "),Be(i.type),Q.mkText(" */")),n.push(Q.mkText(")"),ge(i.body))}return e.finalbody.length&&n.push(Q.mkText("finally"),ge(e.finalbody)),Q.mkStmt(Q.mkGroup(n))},AsyncFunctionDef:function(e){return J(e,9551,$e.U.lf("async function definitions are unsupported")),p(e)},AsyncFor:function(e){return J(e,9552,$e.U.lf("async for statements are unsupported")),p(e)},AsyncWith:function(e){return J(e,9553,$e.U.lf("async with statements are unsupported")),p(e)},Global:function(e){for(var n=S(),t=(C(),0),r=e.names;t<r.length;t++){var i=r[t];$e.U.lookup(n.vars,i)||J(e,9521,$e.U.lf("No binding found for global variable")),I(i,{modifier:D.VarModifier.Global}).firstRefPos<e.startPos&&J(e,9522,$e.U.lf("Variable referenced before global declaration"))}return Q.mkStmt(Q.mkText(""))},Nonlocal:function(e){for(var n=S(),t=C(),r=0,i=e.names;r<i.length;r++){var a=i[r],o=ze(a,t);o&&o!==n&&o.vars[a].modifier!==D.VarModifier.Global||J(e,9523,$e.U.lf("No binding found for nonlocal variable")),I(a,{modifier:D.VarModifier.NonLocal}).firstRefPos<e.startPos&&J(e,9524,$e.U.lf("Variable referenced before nonlocal declaration"))}return Q.mkStmt(Q.mkText(""))}};function n(e){var n,t;if("Assign"===e.kind){if(1!=e.targets.length)return J(e,9553,$e.U.lf("multi-target assignment statements are unsupported")),p(e);t=e.targets[0],n=e.value,null}else{if("AnnAssign"!==e.kind)return e;t=e.target,n=e.value||null,e.annotation}var r="",i=!!n&&Ie(n,"const"),a=Ce(t)||"";if(U()||b.currClass||b.currFun||"_"==a[0]||(r="export "),a&&b.currClass&&!b.currFun){i=!(!n||!b.currClass.isNamespace);var o=re(b.currClass.symInfo,a);if(o||J(e,9544,lf("cannot get class field")),0==x)return Q.mkText("/* skip for now */");o.pyRetType||J(e,9539,lf("function '{0}' missing return type",o.pyQName)),O(t,o.pyRetType),o.isInstance=!1,r=b.currClass.isNamespace?"export "+(i?"const":"let")+" ":"static "}if(!n)return J(e,9555,$e.U.lf("unable to determine value of assignment")),p(e);if(O(t,ue(n)),i)return I(Ce(t),{}),/^static /.test(r)||/const/.test(r)||(r+="const "),Q.mkStmt(Q.mkText(r),Q.mkInfix(Be(t),"=",Be(n)));if(!r&&"Tuple"==t.kind){var s=t,u=[Q.mkText("let "),Q.mkText("[")];if(s.elts.filter(function(e){return"Name"!==e.kind}).length)return J(e,9556,$e.U.lf("non-trivial tuple assignment unsupported")),p(e);var l=s.elts.map(function(e){return e}).map(function(e){Le(e,"identifierCompletion"),ue(e);De(e);return Ne(e,!0)});return u.push(Q.mkCommaSep(l)),u.push(Q.mkText("]")),Q.mkStmt(Q.mkInfix(Q.mkGroup(u),"=",Be(n)))}if("Name"===t.kind){var c=C().vars[a];c&&4===c.kind&&void 0===c.modifier&&(void 0===c.firstAssignPos||c.firstAssignPos>t.startPos)&&(c.firstAssignPos=t.startPos,c.firstAssignDepth=b.blockDepth)}return Q.mkStmt(Q.mkText(r),Q.mkInfix(Be(t),"=",Be(n)))}function Ne(e,n){void 0===n&&(n=!1);var t=e.id,r=se(t),i=C().vars[t];return void 0===e.isdef&&(!r||4===r.kind&&r!==i?b.currClass&&!b.currFun?(e.isdef=!1,r=I(t,{})):r=I(t,{isLocal:e.isdef=!0}):e.isdef=!1,e.symbolInfo=r,e.tsType||J(e,9540,lf("definition missing ts type")),r.pyRetType||J(e,9568,lf("missing py return type")),X(e,e.tsType,r.pyRetType)),e.isdef&&We(r,C())&&(e.isdef=!1),Re(r,e),e.isdef&&!n?Q.mkGroup([Q.mkText("let "),Ue(t)]):Ue(t)}function Ee(e){return Q.isReservedWord(e)?e+"_":e||e}function Ce(e){if("Name"==e.kind){var n=e.id,t=oe(n);return t&&t.expandsTo?t.expandsTo:n}if("Attribute"==e.kind){var r=Ce(e.value);if(r)return r+"."+e.attr}J(null,9542,lf("Cannot get name of unknown expression kind '{0}'",e.kind))}function Ue(e){return"self"==e?Q.mkText("this"):Q.mkText(Ee(e))}function Ie(e,n){return"Call"==e.kind&&Ce(e.func)===n}function we(e,n,t){var r=ye[n];return $e.U.assert(!!r),3<r.length?Q.H.mkCall(r,[e,t]):Q.mkInfix(e,r,t)}var Ae={memoryview:{n:"",t:V},const:{n:"",t:l},"micropython.const":{n:"",t:l}};var Pe,_e=(Pe={},Object.keys(pxtc.ts2PyFunNameMap).forEach(function(e){var n=pxtc.ts2PyFunNameMap[e];if(n&&n.n){var t={n:e,t:function(e){switch(e){case ts.SyntaxKind.StringKeyword:return a;case ts.SyntaxKind.NumberKeyword:return l;case ts.SyntaxKind.BooleanKeyword:return c;case ts.SyntaxKind.VoidKeyword:return m;case ts.SyntaxKind.AnyKeyword:return d;default:return V}}(n.t),scale:n.scale};Pe[n.n]=t}}),Object.keys(Ae).forEach(function(e){Pe[e]=Ae[e]}),Pe);function Ke(e){return G&&e.startPos<=G.position&&G.position<=e.endPos}function Le(e,n){100<x&&G&&null==j&&(G.type==n||"symbol"==G.type)&&Ke(e)&&(j=e,z=C())}function Fe(e,n){if(n&&n.pyAST&&"FunctionDef"==n.pyAST.kind){var t=n.pyAST;t.callers||(t.callers=[]),t.callers.indexOf(e)<0&&t.callers.push(e)}}var Oe={BoolOp:function(e){for(var n=Be(e.values[0]),t=1;t<e.values.length;++t)n=we(n,e.op,Be(e.values[t]));return n},BinOp:function(e){var n=function(e){if("Mod"==e.op&&"Str"==e.left.kind&&("Tuple"==e.right.kind||"List"==e.right.kind)){var n=e.left.s,o=e.right.elts;o=o.slice();var s=[Q.mkText("`")];return n.replace(/([^%]+)|(%[\d\.]*([a-zA-Z%]))/g,function(e,n,t,r){if(n)s.push(Q.mkText(n.replace(/[`\\$]/g,function(e){return"\\"+e})));else{var i=o.shift(),a=i?Be(i):Q.mkText("???");s.push(Q.mkText("${"),a,Q.mkText("}"))}return""}),s.push(Q.mkText("`")),Q.mkGroup(s)}return null}(e);return n||(n=we(Be(e.left),e.op,Be(e.right)),de[e.op]&&(O(e.left,l),O(e.right,l),e.tsType||J(e,9570,lf("binary op missing ts type")),X(e,e.tsType,l)),n)},UnaryOp:function(e){var n=ve[e.op];return $e.U.assert(!!n),Q.mkInfix(null,n,Be(e.operand))},Lambda:function(e){return i(e)},IfExp:function(e){return Q.mkInfix(Q.mkInfix(Be(e.test),"?",Be(e.body)),":",Be(e.orelse))},Dict:function(e){return i(e)},Set:function(e){return i(e)},ListComp:function(e){return i(e)},SetComp:function(e){return i(e)},DictComp:function(e){return i(e)},GeneratorExp:function(n){if(1==n.generators.length&&"Comprehension"==n.generators[0].kind){var t=n.generators[0];if(0==t.ifs.length)return ce(function(){var e=Ce(t.target);return I(e,{isParam:!0}),Q.mkInfix(Be(t.iter),".",Q.H.mkCall("map",[Q.mkGroup([Ue(e),Q.mkText(" => "),Be(n.elt)])]))})}return i(n)},Await:function(e){return i(e)},Yield:function(e){return i(e)},YieldFrom:function(e){return i(e)},Compare:function(e){if(1==e.ops.length&&("In"==e.ops[0]||"NotIn"==e.ops[0])){w(ue(e.comparators[0]))==a&&O(e.left,a);var n=Q.mkInfix(Be(e.comparators[0]),".",Q.H.mkCall("indexOf",[Be(e.left)]));return Q.mkInfix(n,"In"==e.ops[0]?">=":"<",Q.mkText("0"))}for(var t=we(Be(e.left),e.ops[0],Be(e.comparators[0])),r=1;r<e.ops.length;++r)t=we(t,"And",we(Be(e.comparators[r-1]),e.ops[r],Be(e.comparators[r])));return t},Call:function(e){e.func.inCalledPosition=!0;var n,t=Ce(e.func),r=se(t),i=r&&8==r.kind,a=r,o=void 0,s="";if(i)a=se(r.pyQName+".__constructor");else if("Attribute"==e.func.kind){var u=e.func;((n=ue(o=u.value)).classType||n.primType)&&(s=u.attr,(a=ie(o,s,!0))&&(s=a.name))}var l=e.args.slice();if("super"==t&&0==l.length)return b.currClass&&b.currClass.baseClass&&(e.tsType||J(e,9543,lf("call expr missing ts type")),F(e,e.tsType,b.currClass.baseClass.symInfo)),Q.mkText("super");if(!a){var c=$e.U.lookup(_e,t);if(c&&(s=""),s&&(t=_(n)+"."+s,(c=$e.U.lookup(_e,t))||"@array"!=K(w(n))||(t="Array."+s,c=$e.U.lookup(_e,t))),s="",c)if("."==c.n[0]&&l.length){if(n=ue(o=l.shift()),s=c.n.slice(1),(a=ie(o,s))&&2==a.kind)return Q.mkInfix(Be(o),".",Q.mkText(s))}else a=E(c.n)}if(Ie(e,"str"))return Q.mkInfix(Q.mkText('""'),"+",Be(e.args[0]));a||J(e,9508,$e.U.lf("can't find called function \""+t+'"'));var f=a?a.parameters:null,p=[];if(f){for(l.length>f.length&&J(e,9510,$e.U.lf("too many arguments in call to '{0}'",a.pyQName));l.length<f.length;)l.push(null);l=l.slice(0,f.length);for(var m=function(n){var e=f.findIndex(function(e){return e.name==n.arg});e<0?J(n,9511,$e.U.lf("'{0}' doesn't have argument named '{1}'",a.pyQName,n.arg)):null!=l[e]?J(n,9512,$e.U.lf("argument '{0} already specified in call to '{1}'",n.arg,a.pyQName)):l[e]=n.value},d=0,y=e.keywords;d<y.length;d++){m(y[d])}for(var v=l.length-1;0<=v&&("undefined"==f[v].initializer&&null==l[v]);v--)l.pop();for(v=0;v<l.length;++v){null!=(k=l[v])||f[v].initializer?k?(f[v].pyType||J(e,9545,lf("formal arg missing py type")),"any"!==f[v].pyType.primType&&O(k,f[v].pyType),"Name"==k.kind&&he(k.symbolInfo)?p.push(Se(k.symbolInfo.pyAST,!0)):p.push(Be(k))):(f[v].initializer||J(e,9547,lf("formal arg missing initializer")),p.push(Q.mkText(f[v].initializer))):(J(e,9513,$e.U.lf("missing argument '{0}' in call to '{1}'",f[v].name,a.pyQName)),p.push(Q.mkText("null")))}}else a&&J(e,9509,$e.U.lf("calling non-function")),p=l.map(Be);if(!j&&G&&"signature"==G.type&&Ke(e)){j=e,z=C();for(v=G.auxResult=0;v<l.length;++v){var k;if(G.auxResult=v,!(k=l[v]))break;if(k.startPos<=G.position&&G.position<=k.endPos)break}}if(a)if(a.pyRetType||J(e,9549,lf("function missing pyRetType")),O(e,a.pyRetType),(e.symbolInfo=a).attributes.py2tsOverride){var g=function(e){var n,t=new RegExp(/([^\$]*\()?([^\$\(]*)\$(\d)(?:(?:(?:=(\d+|'[a-zA-Z0-9_]*'|false|true|null|undefined))|(\?)|))/,"y"),r=[],i=0;for(;i=t.lastIndex,(n=t.exec(e))&&(n[1]&&r.push({kind:"text",text:n[1]}),r.push({kind:"arg",prefix:n[2],index:parseInt(n[3]),default:n[4],isOptional:!!n[5]})),n;);null!=i?r.push({kind:"text",text:e.substr(i)}):r.push({kind:"text",text:e});return{parts:r}}(a.attributes.py2tsOverride);if(g){s&&!o&&J(e,9550,lf("missing recv"));var x=function(e,n,t){for(var r=[],i=0,a=e.parts;i<a.length;i++){var o=a[i];if("text"===o.kind)r.push(Q.mkText(o.text));else if(n[o.index]||o.default)o.prefix&&r.push(Q.mkText(o.prefix)),n[o.index]?r.push(n[o.index]):r.push(Q.mkText(o.default));else if(!o.isOptional)return}if(t)return Q.mkInfix(t,".",Q.mkGroup(r));return Q.mkGroup(r)}(g,p,s?Be(o):void 0);return x||J(e,9555,lf("buildOverride failed unexpectedly")),x}}else if(a.attributes.pyHelper)return Q.mkGroup([Q.mkInfix(Q.mkText("_py"),".",Q.mkText(a.attributes.pyHelper)),Q.mkText("("),Q.mkCommaSep(o?[Be(o)].concat(p):p),Q.mkText(")")]);var T,h=s?Q.mkInfix(Be(o),".",Q.mkText(s)):Be(e.func),S=[h,Q.mkText("("),Q.mkCommaSep(p),Q.mkText(")")];return a&&1==p.length&&N(a)&&(S=[h,(T=p[0],T.type==Q.NT.Prefix&&'"'==T.op[0]?Q.mkText(Q.backtickLit(JSON.parse(T.op))):T)]),i&&(r&&r.pyQName||J(e,9551,lf("missing namedSymbol or pyQName")),S[0]=Q.mkText(P(r.pyQName)),S.unshift(Q.mkText("new "))),Q.mkGroup(S)},Num:function(e){return e.tsType||J(e,9556,lf("tsType missing")),X(e,e.tsType,l),Q.mkText(e.ns)},Str:function(e){return e.tsType||J(e,9557,lf("tsType missing")),X(e,e.tsType,a),Q.mkText(Q.stringLit(e.s))},FormattedValue:function(e){return i(e)},JoinedStr:function(e){return i(e)},Bytes:function(e){return Q.mkText("hex`"+$e.U.toHex(new Uint8Array(e.s))+"`")},NameConstant:function(e){return null!=e.value&&(e.tsType||J(e,9558,lf("tsType missing")),X(e,e.tsType,c)),Q.mkText(JSON.stringify(e.value))},Ellipsis:function(e){return i(e)},Constant:function(e){return i(e)},Attribute:function(e){var n=Be(e.value),t=ue(e.value),r=ie(e.value,e.attr),i=e.attr;if(Le(e,"memberCompletion"),r)e.symbolInfo=r,Fe(e,r),e.tsType&&r.pyRetType||J(e,9559,lf("tsType or pyRetType missing")),X(e,e.tsType,r.pyRetType),i=r.name;else if(t.moduleType){var a=E(t.moduleType.pyQName+"."+e.attr);a?(e.symbolInfo=a,Fe(e,a),O(e,T(a)),i=a.name):J(e,9514,$e.U.lf("module '{0}' has no attribute '{1}'",t.moduleType.pyQName,e.attr))}else 2<x&&J(e,9515,$e.U.lf("unknown object type; cannot lookup attribute '{0}'",e.attr));return Q.mkInfix(n,".",Q.mkText(Ee(i)))},Subscript:function(e){if("Index"==e.slice.kind){var n=e.slice.value;return 2<x&&L(ue(n))&&O(n,l),Q.mkGroup([Be(e.value),Q.mkText("["),Be(n),Q.mkText("]")])}if("Slice"==e.slice.kind){var t=e.slice;return Q.mkInfix(Be(e.value),".",Q.H.mkCall("slice",[t.lower?Be(t.lower):Q.mkText("0"),t.upper?Be(t.upper):null].filter(f)))}return i(e)},Starred:function(e){return Q.mkGroup([Q.mkText("... "),Be(e.value)])},Name:function(e){if(Le(e,"identifierCompletion"),"self"==e.id&&b.currClass)return e.tsType||J(e,9560,lf("missing tsType")),F(e,e.tsType,b.currClass.symInfo),Q.mkText("this");var n=De(e);return n&&n.isImport?Ue(n.name):(Re(n,e),0<=e.ctx.indexOf("Load")?(n&&!n.qName&&J(e,9561,lf("missing qName")),Ue(n?n.qName:Ce(e))):Ne(e))},List:Me,Tuple:Me};function De(e){var n=se(e.id);if(!n){var t=$e.U.lookup(_e,e.id);t&&(n=se(t.n))}if(n){if(e.symbolInfo=n,e.tsType||J(e,9562,lf("missing tsType")),X(e,e.tsType,T(n)),n.isImport)return n;Fe(e,n)}else 0<x&&J(e,9516,$e.U.lf("name '{0}' is not defined",e.id));return n}function Re(e,n){if(e){if(e.modifier===D.VarModifier.Global)(t=S())&&t.vars[e.name]&&(e=t.vars[e.name]);else if(e.modifier===D.VarModifier.NonLocal){var t;(t=ze(e.name,C()))&&(e=t.vars[e.name])}(void 0===e.firstRefPos||e.firstRefPos>n.startPos)&&(e.firstRefPos=n.startPos)}}function Me(e){return e.tsType||J(e,9563,lf("missing tsType")),X(e,e.tsType,g(e.elts[0]?ue(e.elts[0]):k())),Q.mkGroup([Q.mkText("["),Q.mkCommaSep(e.elts.map(Be)),Q.mkText("]")])}function Be(e){var n=Oe[(u=e).kind];return n||$e.U.oops(e.kind+" - unknown expr"),ue(e),n(e)}function qe(e){var n=be[(u=e).kind];n||$e.U.oops(e.kind+" - unknown stmt");var t=(e._comments||[]).map(function(e){return e.value}),r=n(e);return t.length&&(r=Q.mkGroup(t.map(function(e){return Q.mkStmt(Q.H.mkComment(e))}).concat(r))),r}function Ge(e){return!e||(e.type==Q.NT.Prefix&&""==e.op?e.children.every(Ge):e.type==Q.NT.NewLine)}function ze(e,n){if(n){var t=n.vars&&n.vars[e];return t&&t.modifier!=D.VarModifier.NonLocal?n:ze(e,n.parent)}}function Qe(e){for(var n,t,r,i,a=[],o=0,s=Object.keys(e.vars);o<s.length;o++){var u=s[o];We(n=e.vars[u],e)&&a.push((void 0,r=Ue((t=n).name),i=_(T(t)),Q.mkStmt(Q.mkGroup([Q.mkText("let "),r,Q.mkText(": "+i+";")]))))}return a}function We(e,n){return!!(4===e.kind&&!e.isParam&&void 0===e.modifier&&(e.firstRefPos<e.firstAssignPos||e.firstAssignDepth>n.blockDepth))}function je(e){if($e.U.assert("Module"==e.kind),!e.tsBody){var n;b={currClass:void 0,currFun:void 0,currModule:n=e,blockDepth:0},B=n.tsFilename.replace(/\.ts$/,".py"),e.vars||(e.vars={});var t=Qe(e).concat(e.body.map(qe));if(!t.every(Ge))return"main"==e.name?t:[Q.mkText("namespace "+e.name+" "),Q.mkBlock(t)]}}function Ve(e){x=e,q=[],u=void(W=0)}D.py2ts=function(r){var e=[],n={};q=[],$e.U.assert(!!r.sourceFiles,"missing sourceFiles! Cannot convert py to ts");var t=r.sourceFiles.filter(function(e){return $e.U.endsWith(e,".py")});if(0==t.length)return{outfiles:n,diagnostics:q,success:0===q.length};var i=function(e,n){return e.substr(0,e.length-n.length)},a=$e.U.toDictionary(t,function(e){return i(e,".py")}),o=r.sourceFiles.filter(function(e){return $e.U.endsWith(e,".ts")}).filter(function(e){return i(e,".ts")in a});$e.U.assert(!!r.apisInfo,"missing apisInfo! Cannot convert py to ts"),B=t[0],function(e,n){M={},R={};for(var t=$e.U.toDictionary(n,function(e){return e}),r=function(e){if(t.hasOwnProperty(e.fileName))return"continue";var n=e;n.extendsTypes&&(n.extendsTypes=n.extendsTypes.filter(function(e){return e!=n.qName})),n.pyQName&&n.qName||J(null,9526,$e.U.lf("Symbol '{0}' is missing qName for '{1}'",n.name,n.pyQName?"ts":"py")),R[n.pyQName]=n,R[n.qName]=n},i=0,a=$e.U.values(e.byQName);i<a.length;i++)r(a[i]);V=H("Buffer")}(r.apisInfo,o),G=void 0,r.generatedFiles||(r.generatedFiles=[]);for(var s=0,u=t;s<u.length;s++){var l=u[s],c=l,f=l.replace(/\.py$/,"").replace(/.*\//,""),p=r.fileSystem[l];try{B=l;var m=$e.py.lex(p),d=$e.py.parse(p,c,m);$e.U.pushRange(q,d.diagnostics),e.push({kind:"Module",body:d.stmts,blockDepth:0,name:f,source:p,tsFilename:c.replace(/\.py$/,".ts")})}catch(e){console.log("Parse error",e)}}for(var y=q,v=0;v<5;++v){Ve(v);for(var k=0,g=e;k<g.length;k++){var x=g[k];try{je(x)}catch(e){console.log("Conv pass error",e)}}if(0==W)break}Ve(1e3),j=void 0,G=r.syntaxInfo;for(var T=0,h=e;T<h.length;T++){x=h[T];try{var S=je(x);if(!S)continue;d=Q.flattenNode(S),r.sourceFiles.push(x.tsFilename),r.generatedFiles.push(x.tsFilename),r.fileSystem[x.tsFilename]=d.output,n[x.tsFilename]=d.output}catch(e){console.log("Conv error",e)}}if(q=y.concat(q),G&&(G.symbols=[]),j&&J(null,9569,lf("type annotation error; this should be unreachable")),G&&j){j=j;var b=$e.U.values(R).concat($e.U.values(M));G.beginPos=j.startPos,G.endPos=j.endPos,G.symbols||(G.symbols=[]),G.globalNames=G.globalNames||{};var N=[],E=function(e){if(function(e){switch(e.kind){case 6:case 7:case 4:case 3:case 5:return!0;case 2:case 1:return!e.isInstance;default:return!1}}(e)&&N.indexOf(e)<0){var n=$(e);G.globalNames[n.qName||n.name]=n}};N=G.symbols.slice();for(var C=z;C;C=C.parent)C&&C.vars&&$e.U.values(C.vars).forEach(E);if(b.forEach(E),"memberCompletion"==G.type&&"Attribute"==j.kind){var U=ue(j.value);if(U.moduleType)for(var I=0,w=b;I<w.length;I++)(L=w[I]).isInstance||L.namespace!=U.moduleType.qName||G.symbols.push(L);else if(U.classType||U.primType){var A=U.classType||ae(U.primType).reduce(function(e,n){return e||n},null);if(A){A.extendsTypes&&A.qName||J(null,9567,lf("missing extendsTypes or qName"));for(var P=A.extendsTypes.concat(A.qName),_=0,K=b;_<K.length;_++){var L;(L=K[_]).isInstance&&0<=P.indexOf(L.namespace)&&G.symbols.push(L)}}}}else if("identifierCompletion"==G.type)G.symbols=$e.U.values(G.globalNames);else{var F=j.symbolInfo;F&&G.symbols.push(F)}G.symbols=G.symbols.map($)}var O=function(){for(var e=0,n=q;e<n.length;e++){var t=n[e];D.patchPosition(t,r.fileSystem[t.fileName])}return q}();return{outfiles:n,success:0===O.length,diagnostics:O,syntaxInfo:G}}}($e.py||($e.py={}))}(pxt||(pxt={})),function(K){!function(h){var S,e;(e=S=h.TokenType||(h.TokenType={}))[e.Id=0]="Id",e[e.Op=1]="Op",e[e.Keyword=2]="Keyword",e[e.Number=3]="Number",e[e.String=4]="String",e[e.NewLine=5]="NewLine",e[e.Comment=6]="Comment",e[e.Indent=7]="Indent",e[e.Dedent=8]="Dedent",e[e.EOF=9]="EOF",e[e.Error=10]="Error";var b,N,i,E,a={False:!0,None:!0,True:!0,and:!0,as:!0,assert:!0,async:!0,await:!0,break:!0,class:!0,continue:!0,def:!0,del:!0,elif:!0,else:!0,except:!0,finally:!0,for:!0,from:!0,global:!0,if:!0,import:!0,in:!0,is:!0,lambda:!0,nonlocal:!0,not:!0,or:!0,pass:!0,raise:!0,return:!0,try:!0,while:!0,with:!0,yield:!0},C=[],U={"%":"Mod","&":"BitAnd","*":"Mult","**":"Pow","+":"Add","-":"Sub","/":"Div","//":"FloorDiv","<<":"LShift",">>":"RShift","@":"MatMult","^":"BitXor","|":"BitOr"},I={"!":"Bang","!=":"NotEq","(":"LParen",")":"RParen",",":"Comma","->":"Arrow",".":"Dot",":":"Colon",";":"Semicolon","<":"Lt","<=":"LtE","=":"Assign","==":"Eq",">":"Gt",">=":"GtE","[":"LSquare","]":"RSquare","{":"LBracket","}":"RBracket","~":"Invert"},w={b:/^[_0-1]$/,B:/^[_0-1]$/,o:/^[_0-7]$/,O:/^[_0-7]$/,x:/^[_0-9a-fA-F]$/,X:/^[_0-9a-fA-F]$/},A={b:2,B:2,o:8,O:8,x:16,X:16},P=0,_=0;function r(e,n){for(var t=0,r=0,i=0;i<e;++i)10==n.charCodeAt(i)&&(t++,r=i);return{line:t,column:e-r-1}}function s(e){switch(e.type){case S.Id:return"id("+e.value+")";case S.Op:return"'"+N[e.value]+"'";case S.Keyword:return e.value;case S.Number:return"num("+e.value+")";case S.String:return e.stringPrefix+JSON.stringify(e.value);case S.NewLine:return"<nl>";case S.Comment:return"/* "+e.value+" */";case S.Indent:return"indent"+e.value;case S.Dedent:return"dedent";case S.Error:return"[ERR: "+e.value+"]";case S.EOF:return"End of file";default:return"???"}}h.position=r,h.patchPosition=function(e,n){if(!e.start&&!e.length)return e.start=0,e.length=0,e.line=0,void(e.column=0);var t=r(e.start,n);e.line=t.line,e.column=t.column,0<e.length&&(t=r(e.start+e.length-1,n),e.endLine=t.line,e.endColumn=t.column+2)},h.tokenToString=s,h.friendlyTokenToString=function(e,n){var t=e.endPos-e.startPos;return(0==t?s(e):20<t?"`"+n.slice(e.startPos,e.startPos+20)+"`...":"`"+n.slice(e.startPos,e.endPos)+"`").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/\t/g,"\\t")},h.tokensToString=function(e){for(var n="",t=0,r=0,i=e;r<i.length;r++){var a=i[r],o=s(a);70<t+o.length&&(t=0,n+="\n"),0!=t&&(n+=" "),n+=o,t+=o.length,a.type!=S.NewLine&&a.type!=S.Comment||(t=0,n+="\n")}return n},h.lex=function(e){for(0==C.length&&function(){var s={'"':c,"'":c,"#":v,"\\":y,".":g};b=K.U.clone(I);for(var e=0,n=Object.keys(U);e<n.length;e++){var t=n[e];b[t]=U[t],b[t+"="]=U[t]+"Assign"}N={};for(var r=0,i=Object.keys(b);r<i.length;r++){var t=i[r];N[b[t]]=t}for(var a=function(e){if(h.rx.isIdentifierStart(e))C[e]=u;else{var n=String.fromCharCode(e);if(s.hasOwnProperty(n))C[e]=s[n];else if(b.hasOwnProperty(n)){for(var t=!1,r=b[n],i=0,a=Object.keys(b);i<a.length;i++){var o=a[i];o!=n&&o.startsWith(n)&&(t=!0)}C[e]=t?function(){return function(e){var n=E.slice(_,P+1);if(2==n.length&&b.hasOwnProperty(n)){var t=E.slice(_,P+2);3==t.length&&b.hasOwnProperty(t)?(P+=2,e=b[t]):(P++,e=b[n])}l(e)}(r)}:function(){return l(r)}}else h.rx.isSpace(e)?C[e]=function(){}:13==e?C[e]=function(){10==E.charCodeAt(P)&&P++,f()}:h.rx.isNewline(e)?C[e]=f:x(e)?C[e]=k:C[e]=T}},o=0;o<128;++o)a(o)}(),E=e,i=[],_=P=0,r();P<E.length;){_=P;var n=E.charCodeAt(P++);n<128?C[n]():h.rx.isIdentifierStart(n)?u():h.rx.isSpace(n)||(h.rx.isNewline(n)?f():T())}return _=P,f(),p(S.EOF,""),i;function p(e,n,t){var r={type:e,value:n,startPos:_,endPos:P,auxValue:t};return i.push(r),r}function m(e){p(S.Error,e)}function u(){for(;h.rx.isIdentifierChar(E.charCodeAt(P));)P++;var e=E.slice(_,P),n=E.charCodeAt(P);a.hasOwnProperty(e)?p(S.Keyword,e):34==n||39==n?t(e):p(S.Id,e)}function l(e){p(S.Op,e)}function d(e){switch(e){case 97:return 7;case 98:return 8;case 102:return 12;case 110:return 10;case 114:return 13;case 116:return 9;case 118:return 11;default:return 0}}function t(e){var n=E.charCodeAt(P++),t=!1;E.charCodeAt(P)==n&&E.charCodeAt(P+1)==n&&(P+=2,t=!0);for(var r=0<=(e=e.toLowerCase()).indexOf("r"),i="",a="";;){var o=E.charCodeAt(P++);if(o==n){if(!t)break;if(E.charCodeAt(P)==n&&E.charCodeAt(P+1)==n){P+=2;break}a+="\\"+String.fromCharCode(n),i+=String.fromCharCode(n)}else if(92==o){var s=E.charCodeAt(P++);if(13==s&&10==E.charCodeAt(P)&&(s=10,P++),34==s||39==s||92==s)r&&(a+="\\",i+="\\"),a+="\\"+String.fromCharCode(s),i+=String.fromCharCode(s);else if(!r&&d(s))a+="\\"+String.fromCharCode(s),i+=String.fromCharCode(d(s));else if(h.rx.isNewline(s))r&&(i+="\\"+String.fromCharCode(s),a+="\\\\",a+=10==s?"\\n":"\\u"+("0000"+s.toString(16)).slice(-4));else if(r||48!=s)if(r||117!=s&&120!=s)a+="\\\\"+String.fromCharCode(s),i+="\\"+String.fromCharCode(s);else{var u=117==s?4:2,l=E.slice(P,P+u);P+=u;var c=parseInt(l,16);isNaN(c)&&m(K.U.lf("invalid unicode or hex escape")),a+="\\"+String.fromCharCode(s)+l,i+=String.fromCharCode(c)}else a+="\\\\x00",i+="\0"}else{if(isNaN(o)){m(K.U.lf("end of file in a string"));break}if(h.rx.isNewline(o)&&!t){m(K.U.lf("new line in a string"));break}i+=String.fromCharCode(o),a+=String.fromCharCode(o)}}var f=p(S.String,i);f.quoted=a,f.stringPrefix=e}function c(){P--,t("")}function f(){p(S.NewLine,""),r()}function r(){for(var e=0;;){var n=E.charCodeAt(P);if(9!=n){if(32!=n)break;e++,P++}else e=e+8&-8,P++}p(S.Indent,""+e)}function y(){var e=E.charCodeAt(P);h.rx.isNewline(e)?(P++,13==e&&10==E.charCodeAt(P)&&P++):m(K.U.lf("unexpected character after line continuation character"))}function v(){for(p(S.NewLine,"");P<E.length&&!h.rx.isNewline(E.charCodeAt(P));)P++;p(S.Comment,E.slice(_+1,P)),13==E.charCodeAt(P)&&10==E.charCodeAt(P+1)&&P++,P++,r()}function k(){var e=E[_],n="";if("0"==e){var t=E[P],r=w[t];if(r){for(P++;;){var i=E[P];if(!r.test(i))break;n+=i,P++}if(n){var a=parseInt(n,A[t]);isNaN(a)&&m(K.U.lf("invalid number")),p(S.Number,e+t+n,a)}else m(K.U.lf("expecting numbers to follow 0b, 0o, 0x"));return}}var o=!1,s=!1,u=!1;for(P=_;;){if(i=E.charCodeAt(P),!u||43!=i&&45!=i)if(u=!1,95==i||x(i));else if(s||o||46!=i){if(s||69!=i&&101!=i)break;u=s=!0}else o=!0;n+=String.fromCharCode(i),P++}!o&&!s&&"0"==e&&1<n.length&&!/^0+/.test(n)&&m(K.U.lf("unexpected leading zero"));var l=parseFloat(n);isNaN(l)&&m(K.U.lf("invalid number")),p(S.Number,n,l)}function g(){x(E.charCodeAt(P))?k():p(S.Op,"Dot")}function x(e){return 48<=e&&e<=57}function T(){m(K.U.lf("invalid token"))}}}(K.py||(K.py={}))}(pxt||(pxt={})),function(Ie){!function(m){var d,a,i,o,s,y,u,v,k,g=!1,x="";function T(){return a[s]}function l(){for(;a[s];s++){var e=a[s];if(e.type!=m.TokenType.Comment){if(0<=d&&e.type==m.TokenType.Op)switch(e.value){case"LParen":case"LSquare":case"LBracket":d++;break;case"RParen":case"RSquare":case"RBracket":d--}if(e.type!=m.TokenType.Error){if(0<d){if(e.type==m.TokenType.NewLine||e.type==m.TokenType.Indent)continue}else if(e.type==m.TokenType.Indent){if(a[s+1].type==m.TokenType.NewLine){s++;continue}var n=parseInt(e.value),t=u[u.length-1];if(n==t)continue;if(t<n)return void u.push(n);e.type=m.TokenType.Dedent;for(var r=0;u.length;){var i=u[u.length-1];if(!(n<i)){for(i!=n&&S(9552,Ie.U.lf("inconsitent indentation"));1<r;)a.splice(s,0,e),r--;return}u.pop(),r++}}return}S(9551,e.value)}else y.push(e)}}function h(){(v=T()).type!=m.TokenType.EOF&&(s++,l())}function S(e,n){n||(n=Ie.U.lf("invalid syntax")),e||(e=9550);var t=T(),r={code:e,category:pxtc.DiagnosticCategory.Error,messageText:Ie.U.lf("{0} near {1}",n,m.friendlyTokenToString(t,i)),fileName:o,start:t.startPos,length:t.endPos?t.endPos-t.startPos:0,line:0,column:0};m.patchPosition(r,i),g&&Ie.log(x+"TS"+e+" "+r.messageText+" at "+(r.line+1)+","+(r.column+1)),k.push(r),9572!=e&&100<k.length&&Ie.U.userError(Ie.U.lf("too many parse errors"))}function n(e,n){var t=T();(t.type==e&&t.value==n||(S(9553,Ie.U.lf("expecting {0}",m.tokenToString({type:e,value:n,startPos:0,endPos:0}))),t.type!=m.TokenType.NewLine))&&h()}function b(){n(m.TokenType.NewLine,"")}function c(e){n(m.TokenType.Keyword,e)}function f(e){n(m.TokenType.Op,e)}function N(){var e=T();return e.type==m.TokenType.Keyword?e.value:""}function E(){var e=T();return e.type==m.TokenType.Op?e.value:""}var C={if:function e(){var n=p("If");h();n.test=j();n.body=r();"elif"==N()?n.orelse=[e()]:n.orelse=I();return U(n)},while:function(){var e=p("While");return c("while"),e.test=j(),e.body=r(),e.orelse=I(),U(e)},for:function(){var e=p("For");return c("for"),e.target=M(),B(e.target),c("in"),e.iter=R(),e.body=r(),e.orelse=I(),U(e)},try:function(){var e=p("Try");c("try"),e.body=r(),e.handlers=[];for(var n=!1;"except"==N();){var t=p("ExceptHandler");e.handlers.push(t),h(),"Colon"!=E()?(n&&S(),t.type=j(),"as"==N()?(h(),t.name=xe()):t.name=void 0):(n=!0,t.type=void 0,t.name=void 0),t.body=r()}e.orelse=I(),0==e.handlers.length&&e.orelse.length&&S();"finally"==N()?(h(),e.finalbody=r()):e.finalbody=[];return U(e)},with:function(){var e=p("With");return c("with"),e.items=ve(Ie.U.lf("with item"),w),e.body=r(),U(e)},def:function(){var e=p("FunctionDef");c("def"),e.name=xe(),f("LParen"),e.args=Q(!0),f("RParen"),e.returns=void 0,"Arrow"==E()&&(h(),e.returns=j());return e.body=r(),U(e)},class:function(){var e=p("ClassDef");if(c("class"),e.name=xe(),"LParen"==E()){var n=Te();e.bases=n.args,e.keywords=n.keywords}else e.bases=[],e.keywords=[];return e.body=r(),U(e)}},t={del:function(){var e=p("Delete");return c("del"),e.targets=ye(Ie.U.lf("expression"),oe),U(e)},pass:function(){var e=p("Pass");return c("pass"),U(e)},break:function(){var e=p("Break");return h(),U(e)},continue:function(){var e=p("Continue");return h(),U(e)},return:function(){var e=p("Return");h(),P()?e.value=void 0:e.value=R();return U(e)},raise:function(){var e=p("Raise");c("raise"),e.exc=void 0,e.cause=void 0,P()||(e.exc=j(),"from"==N()&&(h(),e.cause=j()));return U(e)},global:_,nonlocal:function(){var e=_();return e.kind="Nonlocal",e},import:function(){var e=p("Import");return h(),e.names=ve(Ie.U.lf("import name"),L),U(e)},from:function(){var e=p("ImportFrom");h(),e.level=function(){for(var e=0;;)if("Dot"==E())e+=1,h();else{if("Ellipsis"!=E())return e;e+=3,h()}}(),T().type==m.TokenType.Id?e.module=K():e.module=void 0;e.level||e.module||S();if(c("import"),"Mult"==E()){h();var n=p("Alias");n.name="*",e.names=[n]}else"LParen"==E()?(h(),e.names=ye(Ie.U.lf("import name"),F),f("RParen")):e.names=ye(Ie.U.lf("import name"),F);return U(e)},assert:function(){var e=p("Assert");h(),e.test=j(),"Comma"==E()?(h(),e.msg=j()):e.msg=void 0;return U(e)},yield:function(){T();if(h(),"from"==N()){var e=p("YieldFrom");return e.value=j(),A(U(e))}var n=p("Yield");P()||(n.value=R());return A(U(n))}};function r(){return f("Colon"),function(){{if(T().type==m.TokenType.NewLine){var e=x;g&&(Ie.log(x+"{"),x+="  "),h();var n=void 0;if(T().type!=m.TokenType.Indent)S(9554,Ie.U.lf("expected an indented block")),n=z();else{var t=parseInt(T().value);for(h(),n=z();;){if(T().type==m.TokenType.Dedent){var r=isNaN(t)||parseInt(T().value)<t;if(h(),r)break}Ie.U.pushRange(n,z())}}return g&&(x=e,Ie.log(x+"}")),n}return G()}}()}function p(e,n){var t=n||T();return{startPos:t.startPos,endPos:t.endPos,kind:e}}function U(e){return e.endPos=v.endPos,e}function I(){return"else"==N()?(h(),r()):[]}function w(){var e=p("WithItem");return e.context_expr=j(),e.optional_vars=void 0,"as"==N()&&(h(),e.optional_vars=oe()),U(e)}function A(e){var n=p("ExprStmt");return n.startPos=e.startPos,n.endPos=e.endPos,n.value=e,n}function P(){var e=T();return e.type==m.TokenType.NewLine||e.type==m.TokenType.Op&&"Semicolon"==e.value}function _(){var e=p("Global");for(h(),e.names=[];e.names.push(xe()),"Comma"==E();)h();return U(e)}function K(){for(var e="";;){if(e+=xe(),"Dot"!=E())return e;e+=".",h()}}function L(){var e=p("Alias");return e.name=K(),"as"==N()?(h(),e.asname=xe()):e.asname=void 0,U(e)}function F(){var e=p("Alias");return e.name=xe(),"as"==N()?(h(),e.asname=xe()):e.asname=void 0,U(e)}function O(e,n){var t=p("Tuple",e);return t.elts=n,U(t)}function e(e){var n=T(),t=ye(Ie.U.lf("expression"),e),r=t[0];return 1!=t.length?O(n,t):r}function D(){return e(ue)}function R(){return e(j)}function M(){return e(oe)}function B(e){"Tuple"==e.kind?e.elts.forEach(B):e.ctx="Store"}function q(){var e=Ie.U.lookup(t,N());return e?e():function(){var e=T(),n=D(),t=E();if("Assign"==t){var r=p("Assign");for(r.targets=[n];;){if(h(),n=D(),"Assign"!=(t=E())){r.value=n;break}r.targets.push(n)}return r.targets.forEach(B),U(r)}if("Colon"==t){var i=p("AnnAssign");return i.target=n,h(),i.annotation=j(),"Assign"==E()&&(h(),i.value=j()),i.simple=e.type==m.TokenType.Id&&"Name"==n.kind?1:0,B(i.target),U(i)}if(Ie.U.endsWith(t,"Assign")){var a=p("AugAssign");return a.target=n,a.op=t.replace("Assign",""),h(),a.value=R(),B(a.target),U(a)}if("Semicolon"==t||T().type==m.TokenType.NewLine){var o=p("ExprStmt");return o.value=n,U(o)}return S(9555,Ie.U.lf("unexpected token")),h(),null}()}function G(){for(var e=[q()];"Semicolon"==E()&&(h(),T().type!=m.TokenType.NewLine);)e.push(q());return b(),e.filter(function(e){return!!e})}function z(){var e=k.length,n=T().type==m.TokenType.Indent;n&&(h(),S(9573,Ie.U.lf("unexpected indent")));for(var t=[];"MatMult"==E();)h(),t.push(Se()),b();var r=N(),i=Ie.U.lookup(C,N()),a=[],o=y;(y=[],"class"==r||"def"==r)?((p=i()).decorator_list=t,a=[p]):t.length?S(9556,Ie.U.lf("decorators not allowed here")):a=i?[i()]:G();o.length&&a.length&&(a[0]._comments=o);var s,u,l=[];if(k.length>e){for(d=-1;v.type!=m.TokenType.Dedent&&v.type!=m.TokenType.NewLine&&(h(),g&&l.push(m.tokenToString(T())),T().type!=m.TokenType.EOF););n&&T().type===m.TokenType.Dedent&&h(),d=0,g&&Ie.log(x+"skip: "+l.join(", "))}if(g)for(var c=0,f=a;c<f.length;c++){var p=f[c];s="stmt",u=p,g&&Ie.log(x+s+": "+u.kind)}return a}function Q(n){var e=p("Arguments");for(e.args=[],e.defaults=[],e.kwonlyargs=[],e.kw_defaults=[],e.vararg=void 0;;){var t=E();if("Colon"==t||"RParen"==t)break;if("Mult"==t)e.vararg&&S(9557,Ie.U.lf("multiple *arg")),h(),T().type==m.TokenType.Id?e.vararg=a():e.vararg=void 0;else if("Pow"==t)e.kwarg&&S(9558,Ie.U.lf("multiple **arg")),h(),e.kwarg=a();else{e.kwarg&&S(9559,Ie.U.lf("arguments after **"));var r=a(),i=void 0;"Assign"==E()&&(h(),i=j()),void 0!==e.vararg&&i?(e.kwonlyargs.push(r),e.kw_defaults.push(i)):(e.args.push(r),i?e.defaults.push(i):e.defaults.length&&S(9560,Ie.U.lf("non-default argument follows default argument")))}if("Comma"!=E())break;h()}return e.kwarg||(e.kwarg=void 0),e.vararg||(e.vararg=void 0),U(e);function a(){var e=p("Arg");return e.arg=xe(),e.annotation=void 0,n&&"Colon"==E()&&(h(),e.annotation=j()),e}}function W(e){var n=p("Lambda");return h(),n.args=Q(!1),f("Colon"),n.body=e?le():j(),U(n)}function j(){if("lambda"==N())return W();var e=T(),n=H();if("if"==N()){var t=p("IfExp",e);return t.body=n,c("if"),t.test=H(),c("else"),t.orelse=j(),U(t)}return n}function V(e,n){var t=T(),r=n();if(N()==e){var i=p("BoolOp",t);for(i.op="or"==e?"Or":"And",i.values=[r];N()==e;)c(e),i.values.push(n());return U(i)}return r}function $(){return V("and",J)}function H(){return V("or",$)}function J(){if("not"==N()){var e=p("UnaryOp");return h(),e.op="Not",e.operand=J(),U(e)}return function(){var e=T(),n=oe();if(!Y())return n;var t=p("Compare",e);t.left=n,t.comparators=[],t.ops=[];for(;;){var r=Y();if(!r)break;h(),"NotIn"==r?c("in"):"Is"==r&&"not"==N()&&(h(),r="IsNot"),t.ops.push(r),t.comparators.push(oe())}return U(t)}()}var X={Lt:"Lt",Gt:"Gt",Eq:"Eq",GtE:"GtE",LtE:"LtE",NotEq:"NotEq",in:"In",not:"NotIn",is:"Is"};function Y(){return X[E()]||X[N()]||null}var Z={Invert:"Invert",Sub:"USub",Add:"UAdd"};function ee(e,n){for(var t=T(),r=e();;){var i=E();if(!(i&&0<=n.indexOf(","+i+",")))return r;var a=p("BinOp",t);a.left=r,a.op=i,h(),a.right=e(),r=a}}function ne(){return ee(be,",Mult,MatMult,Div,Mod,FloorDiv,")}function te(){return ee(ne,",Add,Sub,")}function re(){return ee(te,",LShift,RShift,")}function ie(){return ee(re,",BitAnd,")}function ae(){return ee(ie,",BitXor,")}function oe(){return ee(ae,",BitOr,")}function se(){var e=T(),n=void 0;if("Colon"!=E()&&(n=j()),"Colon"==E()){var t;(t=p("Slice",e)).lower=n,h();var r=E();return t.upper="Colon"!=r&&"Comma"!=r&&"RSquare"!=r?j():void 0,t.step=void 0,"Colon"==E()&&(h(),"Comma"!=(r=E())&&"RSquare"!=r&&(t.step=j())),U(t)}return n||S(9570,Ie.U.lf("unable to parse lower subscript")),(t=p("Index")).value=n,U(t)}function ue(){if("Mult"==E()){var e=p("Starred");return e.value=oe(),U(e)}return j()}function le(){return"lambda"==N()?W(!0):H()}function ce(){for(var e=[];;){var n=p("Comprehension");for(n.is_async=0,e.push(n),c("for"),n.target=M(),B(n.target),c("in"),n.iter=H(),n.ifs=[];"if"==N();)h(),n.ifs.push(le());if("for"!=N())return e}}function fe(){var e=T();if("Mult"==E()){var n=p("Starred");return h(),n.value=j(),U(n)}if("Pow"==E()){n=p("Keyword");return h(),n.arg=void 0,n.value=j(),U(n)}var t=j();return"Assign"==E()?("Name"!=t.kind&&S(9561,Ie.U.lf("invalid keyword argument; did you mean ==?")),h(),(n=p("Keyword",e)).arg=t.id||"???",n.value=j(),U(n)):"for"==N()?((n=p("GeneratorExp",e)).elt=t,n.generators=ce(),U(n)):t}function pe(){var e=p("NameConstant");return e.value=void 0,h(),U(e)}function me(){var e=T();if(e.type==m.TokenType.Id){var n=p("Name");return h(),n.id=e.value,n.ctx="Load",U(n)}if(e.type==m.TokenType.Number){n=p("Num");return h(),n.ns=e.value,n.n=e.auxValue,U(n)}if(e.type==m.TokenType.String){h();for(var t=e.value;T().type==m.TokenType.String;)t+=T().value,h();return"b"==e.stringPrefix?(n=p("Bytes",e)).s=Ie.U.toArray(Ie.U.stringToUint8Array(t)):(n=p("Str",e)).s=t,U(n)}if(e.type==m.TokenType.Keyword){if("None"==e.value||"True"==e.value||"False"==e.value){n=p("NameConstant");return h(),n.value="True"==e.value||"False"!=e.value&&void 0,U(n)}return S(9564,Ie.U.lf("expecting atom")),pe()}if(e.type==m.TokenType.Op){var r=e.value;return"LParen"==r?ge("RParen","Tuple","GeneratorExp"):"LSquare"==r?ge("RSquare","List","ListComp"):"LBracket"==r?function(){var s=T();if(h(),"Pow"==E())return h(),t(void 0,oe());if("RBracket"==E()){var e=p("Dict",s);return h(),e.keys=[],e.values=[],U(e)}var n=ue();return"Starred"!=n.kind&&"Colon"==E()?(h(),t(n,j())):function(e){if("for"==N()){"Starred"==e.kind&&S(9562,Ie.U.lf("iterable unpacking cannot be used in comprehension"));var n=p("SetComp",s);return n.elt=e,n.generators=ce(),U(n)}var t=p("Set",s);if(t.elts=[e],"Comma"==E()){var r=ke("RBracket",Ie.U.lf("set element"),ue);t.elts=[e].concat(r)}else f("RBracket");return U(t)}(n);function u(){if("Pow"==E())return h(),[null,oe()];var e=j();return f("Colon"),[e,j()]}function t(e,n){if("for"==N()){e||S(9563,Ie.U.lf("dict unpacking cannot be used in dict comprehension"));var t=p("DictComp",s);return t.key=e,t.value=n,t.generators=ce(),U(t)}var r=p("Dict",s);if(r.keys=[e],r.values=[n],"Comma"==E())for(var i=0,a=ke("RBracket",Ie.U.lf("dict element"),u);i<a.length;i++){var o=a[i];2<=o.length&&o[0]&&o[1]&&(r.keys.push(o[0]),r.values.push(o[1]))}else f("RBracket");return U(r)}}():(S(9565,Ie.U.lf("unexpected operator")),pe())}return S(9566,Ie.U.lf("unexpected token")),pe()}function de(){var e=E();return"RParen"==e||"RSquare"==e||"RBracket"==e||"Colon"==e||"Semicolon"==e||(!!Ie.U.endsWith(e,"Assign")||("in"==N()||T().type==m.TokenType.NewLine))}function ye(e,n){var t=[];if(de())return t;for(;;){t.push(n());var r="Comma"==E();if(r&&h(),de())return t;if(!r)return S(9567,Ie.U.lf("expecting {0}",e)),t}}function ve(e,n){for(var t=[];t.push(n()),"Comma"==E();)h();return t}function ke(e,n,t){h();var r=[];if(E()!=e)for(;;){r.push(t());var i="Comma"==E();if(i&&h(),E()==e)break;if(!i){S(9568,Ie.U.lf("expecting {0}",n));break}}return f(e),r}function ge(e,n,t){var r=T();if(h(),E()==e)return h(),(a=p(n,r)).elts=[],U(a);var i=ue();if("for"==N())return(a=p(t,r)).elt=i,a.generators=ce(),f(e),U(a);if("Comma"==E()){var a=p(n,r);return h(),a.elts=ye(Ie.U.lf("expression"),ue),a.elts.unshift(i),f(e),U(a)}return f(e),"List"==n?((a=p(n,r)).elts=[i],U(a)):i}function xe(){var e=T();return e.type!=m.TokenType.Id&&S(9569,Ie.U.lf("expecting identifier")),h(),e.value}function Te(){for(var e=[],n=[],t=0,r=ke("RParen",Ie.U.lf("argument"),fe);t<r.length;t++){var i=r[t];"Keyword"==i.kind?n.push(i):(n.length&&S(9570,Ie.U.lf("positional argument follows keyword argument")),e.push(i))}return{args:e,keywords:n}}function he(e,n){var t=E();if("LParen"==t){(i=p("Call",e)).func=n;var r=Te();return i.args=r.args,i.keywords=r.keywords,U(i)}if("LSquare"==t){var i,a=T();(i=p("Subscript",e)).value=n;var o=ke("RSquare",Ie.U.lf("subscript"),se);if(0==o.length)S(9571,Ie.U.lf("need non-empty index list"));else if(1==o.length)i.slice=o[0];else if(o.every(function(e){return"Index"==e.kind})){var s=o[0];s.value=O(a,o.map(function(e){return e.value})),i.slice=s}else{var u=p("ExtSlice",a);u.dims=o,i.slice=U(u)}return U(i)}return"Dot"==t?((i=p("Attribute",e)).value=n,h(),i.attr=xe(),U(i)):n}function Se(){for(var e=T(),n=me();;){var t=he(e,n);if(t===n)return n;n=t}}function be(){if(Z[E()]){var e=p("UnaryOp");return e.op=Z[E()],h(),e.operand=be(),U(e)}return function(){T();var e=Se();if("Pow"==E()){var n=p("BinOp");return h(),n.left=e,n.op="Pow",n.right=be(),U(n)}return e}()}var Ne={kind:1,id:2,n:3,s:4,func:5,key:6,elt:7,elts:8,keys:9,left:10,ops:11,comparators:12,names:13,items:14,test:15,targets:16,dims:17,context_expr:18,name:19,bases:20,type:21,inClass:22,target:23,annotation:24,simple:25,op:26,operand:27,right:28,values:29,iter:30,ifs:31,is_async:32,value:33,slice:34,attr:35,generators:36,args:37,keywords:38,body:39,handlers:40,orelse:41,finalbody:42,decorator_list:43,kwonlyargs:44,kw_defaults:45,defaults:46,arg:47},Ee={lineno:1,col_offset:1,startPos:1,endPos:1,kind:1},Ce={body:1,orelse:1,finalbody:1},Ue={_comments:1,ctx:1,ns:1};m.dump=function(e,y){void 0===y&&(y=!1);for(var v=function(e,n){if(Array.isArray(n)){for(var t="",r=0;r<n.length;++r)0<r&&(t+=", "),t+=v(e,n[r]);return"["+t+"]"}if(!n||!n.kind)return JSON.stringify(n);var i="",a=Object.keys(n);a.sort(function(e,n){return(Ne[e]||100)-(Ne[n]||100)||Ie.U.strcmp(e,n)});for(var o=0,s=a;o<s.length;o++){var u=s[o];if(!(Ie.U.lookup(Ee,u)||y&&Ie.U.lookup(Ue,u)))if(i&&(i+=", "),i+=u+"=",Array.isArray(n[u])&&n[u].length&&Ie.U.lookup(Ce,u)){i+="[\n";for(var l=e+"  ",c=0,f=n[u];c<f.length;c++){var p=f[c];i+=l+v(l,p)+"\n"}i+=e+"]"}else if("_comments"==u){i+="[\n",l=e+"  ";for(var m=0,d=n[u];m<d.length;m++)p=d[m],i+=l+JSON.stringify(p.value)+"\n";i+=e+"]"}else i+=v(e,n[u])}return n.kind+"("+i+")"},n="",t=0,r=e;t<r.length;t++){var i=r[t];n+=v("",i)+"\n"}return n},m.parse=function(e,n,t){i=e,o=n,a=t,y=[],u=[s=d=0],k=[];var r=[];try{if(v=a[0],l(),T().type!=m.TokenType.EOF)for(r=z();T().type!=m.TokenType.EOF;)Ie.U.pushRange(r,z())}catch(e){S(9572,Ie.U.lf("exception: {0}",e.message))}return{stmts:r,diagnostics:k}}}(Ie.py||(Ie.py={}))}(pxt||(pxt={})),function(W){!function(n){function z(e,n,t){var r={fileName:e.getSourceFile().fileName,start:e.getStart(),length:e.getEnd()-e.getStart(),line:void 0,column:void 0,code:n,category:pxtc.DiagnosticCategory.Error,messageText:t},i=new Error(t);throw i.pyDiagnostic=r,i}n.decompileToPython=function(e,n){var t={blocksInfo:void 0,outfiles:{},diagnostics:[],success:!0,times:{}};try{var r=function(e,t){var y=[{vars:{}}],v=e.getTypeChecker(),n=(new ts.pxtc.LSHost(e),e.getSourceFile(t)),r=W.U.toSet(["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EnvironmentError","Exception","False","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","NameError","None","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","True","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError","_","__build_class__","__debug__","__doc__","__import__","__loader__","__name__","__package__","__spec__","abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","copyright","credits","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","license","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","quit","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],function(e){return e}),i=ts.pxtc.decompiler.buildRenameMap(e,n,r),a=i[0],m=i[1],o=pxtc.getApiInfo(e),s=W.U.mapMap(o.byQName,function(e,n){return n.fileName==t?void 0:n});return n.getChildren().map(g).reduce(function(e,n){return e.concat(n)},[]).join("\n");function A(e){if(!e.getSourceFile())return null;var n=e.getText(),t=s[n];return t&&t.pyQName?t.pyQName:n in pxtc.ts2PyFunNameMap?pxtc.ts2PyFunNameMap[n].n:null}function P(e){var n=A(e);if(n)return n;if(!ts.isIdentifier(e))return z(e,3001,"Unsupported advanced name format: "+e.getText());var t=e.text,r=e.getSourceFile();if(a&&r){var i=a.getRenameForPosition(e.getStart());i&&(t=i.name)}return t}function k(e,n){return 0!=(e.flags&n)}function u(e,n){var t=v.getTypeAtLocation(e);return k(t,n)}function _(e){return u(e,ts.TypeFlags.StringLike)}function S(e){return u(e,ts.TypeFlags.NumberLike)}function g(e){switch(e.kind){case ts.SyntaxKind.SyntaxList:return e._children.map(g).reduce(function(e,n){return e.concat(n)},[]);case ts.SyntaxKind.EndOfFileToken:case ts.SyntaxKind.OpenBraceToken:case ts.SyntaxKind.CloseBraceToken:return[];default:return function(e){var n=[];if(0<e.getLeadingTriviaWidth()){var t=e.getFullText().slice(0,e.getLeadingTriviaWidth()),r=t.split("\n"),i=r.map(function(e){var n=e.trim();return n?n.startsWith("//")?["comment","#"+n.slice(2,n.length)]:"unknown":"blank"}).filter(function(e){return"unknown"!==e}).map(function(e){return"blank"===e?"":e[1]});i&&!i[0]&&i.shift(),i&&!i[i.length-1]&&i.pop(),n=n.concat(i)}return n=n.concat(b(e))}(e)}}function b(e){return ts.isVariableStatement(e)?e.declarationList.declarations.map(I).reduce(function(e,n){return e.concat(n)},[]):ts.isClassDeclaration(e)?function(e){var n=[];if(!e.name)return z(e,3011,"Unsupported: anonymous class");var t=e.members.every(x),r=P(e.name);t?n.push("class "+r+"(Enum):"):n.push("class "+r+":");var i=e.members.map(T).reduce(function(e,n){return e.concat(n)},[]).filter(function(e){return e});return i.length&&(n=n.concat(i.map(Q))),n}(e):ts.isEnumDeclaration(e)?function(e){var n=[];n.push("class "+P(e.name)+"(Enum):");var t=e.members.every(function(e){return!!e.initializer}),r=!e.members.every(function(e){return!!e.initializer});if(!t&&!r)return z(e,3005,"Unsupported enum decleration: has mixture of explicit and implicit initialization");if(t)return z(e,3006,"Unsupported: explicit enum initialization");for(var i=0,a=0,o=e.members;a<o.length;a++){var s=o[a];n.push(Q(P(s.name)+" = "+i++))}return n}(e):ts.isExpressionStatement(e)?function(e){var n=E(e.expression);if(n)return n;var t=G(e.expression),r=t[0];return t[1].concat(r)}(e):ts.isFunctionDeclaration(e)?C(e):ts.isIfStatement(e)?(p=function e(n){var t=[],r=G(n.expression),i=r[0],a=r[1];t=t.concat(a);var o="if "+L(i)+":",s=[],u=N(n.thenStatement);if(s=s.concat(u),n.elseStatement)if(ts.isIfStatement(n.elseStatement)){var l=e(n.elseStatement),c=l.supportStmts,f=l.ifStmt,p=l.rest,m="el"+f;t=t.concat(c),s.push(m),s=s.concat(p)}else{s.push("else:");var d=N(n.elseStatement);s=s.concat(d)}return{supportStmts:t,ifStmt:o,rest:s}}(e),m=p.supportStmts,d=p.ifStmt,y=p.rest,m.concat([d]).concat(y)):ts.isForStatement(e)?function(e){var n=function(e){if(!e.initializer)return null;if(e.initializer.kind!==ts.SyntaxKind.VariableDeclarationList)return null;var n=e.initializer;if(1!==n.declarations.length)return null;var t=n.declarations[0],r=P(t.name);if(!t.initializer||!function n(e,t){var r=function(e){return n(e,t)};return ts.isBinaryExpression(e)?r(e.left)&&r(e.right):ts.isPropertyAccessExpression(e)?r(e.expression):ts.isPrefixUnaryExpression(e)||ts.isPostfixUnaryExpression(e)?e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken&&r(e.operand):ts.isParenthesizedExpression(e)?r(e.expression):ts.isArrayLiteralExpression(e)?e.elements.map(r).reduce(function(e,n){return e&&n},!0):ts.isElementAccessExpression(e)?r(e.expression)&&(!e.argumentExpression||r(e.argumentExpression)):t(e)}(t.initializer,function(e){switch(e.kind){case ts.SyntaxKind.PropertyAccessExpression:case ts.SyntaxKind.BinaryExpression:case ts.SyntaxKind.ParenthesizedExpression:case ts.SyntaxKind.ArrayLiteralExpression:case ts.SyntaxKind.ElementAccessExpression:case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:case ts.SyntaxKind.NoSubstitutionTemplateLiteral:return!0;case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:case ts.SyntaxKind.Identifier:case ts.SyntaxKind.ThisKeyword:return!1;case ts.SyntaxKind.PrefixUnaryExpression:case ts.SyntaxKind.PostfixUnaryExpression:var n=e;return n.operator!==ts.SyntaxKind.PlusPlusToken&&n.operator!==ts.SyntaxKind.MinusMinusToken}return!1})||!S(t.initializer))return null;var i=G(t.initializer),a=i[0];if(i[1].length)return null;var o=L(a);if(!e.condition)return null;if(!ts.isBinaryExpression(e.condition))return null;if(!ts.isIdentifier(e.condition.left))return null;if(P(e.condition.left)!=r)return null;if(!S(e.condition.right))return null;var s=G(e.condition.right),u=s[0];if(s[1].length)return null;var l,c,f=L(u),p=f;if(e.condition.operatorToken.kind===ts.SyntaxKind.LessThanEqualsToken&&(l=f,(c=Math.floor(Number(l)))!==1/0&&String(c)===l))p=""+(Number(f)+1);else if(e.condition.operatorToken.kind!==ts.SyntaxKind.LessThanToken)return null;return e.incrementor&&(ts.isPostfixUnaryExpression(e.incrementor)||ts.isPrefixUnaryExpression(e.incrementor))?e.incrementor.operator!==ts.SyntaxKind.PlusPlusToken?null:o<p?{name:r,fromIncl:o,toExcl:p}:null:null}(e);if(n){var t=n.name,r=n.fromIncl,i=n.toExcl,a="0"===r?"for "+t+" in range("+i+"):":"for "+t+" in range("+r+", "+i+"):",o=N(e.statement);return[a].concat(o)}var s,u=[];if(e.initializer)if(ts.isVariableDeclarationList(e.initializer)){var l=e.initializer.declarations.map(I).reduce(function(e,n){return e.concat(n)},[]);u=u.concat(l)}else{var c=G(e.initializer),f=c[0],p=c[1];u=u.concat(p).concat(f)}if(e.condition){var m=G(e.condition),d=m[0],y=m[1];u=u.concat(y),s=L(d)}else s="True";var v="while "+s+":";u.push(v);var k=b(e.statement).map(Q);if(0!==k.length||e.incrementor||(k=[Q("pass")]),u=u.concat(k),e.incrementor){var g=E(e.incrementor);if(g)u=u.concat(g.map(Q));else{var x=G(e.incrementor),T=x[0],h=x[1];u=u.concat(h).concat(T.map(Q))}}return u}(e):ts.isForOfStatement(e)?function(e){if(!ts.isVariableDeclarationList(e.initializer))return z(e,3003,"Unsupported expression in for..of initializer: "+e.initializer.getText());var n=e.initializer.declarations.map(function(e){return P(e.name)});if(1!==n.length)return z(e,3004,"Unsupported multiple declerations in for..of: "+e.initializer.getText());var t=n[0],r=G(e.expression),i=r[0],a=r[1];a=a.concat(F("for "+t+" in ",i,":"));var o=N(e.statement);return a=a.concat(o)}(e):ts.isWhileStatement(e)?(s=G((o=e).expression),u=s[0],l=s[1],c=N(o.statement),f=F("while ",u),l.concat(f).concat(c)):ts.isReturnStatement(e)?function(e){if(!e.expression)return["return"];var n=G(e.expression),t=n[0],r=n[1],i=F("return ",t);return r.concat(i)}(e):ts.isBlock(e)?h(e):ts.isTypeAliasDeclaration(e)?(i=e,a=pxtc.emitType(i.type),[P(i.name)+" = "+a]):ts.isEmptyStatement(e)?[]:ts.isModuleDeclaration(e)?(t=P((n=e).name),r=n.body&&n.body.getChildren().map(g).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return Q(e)}),["@namespace","class "+t+":"].concat(r||[])):ts.isBreakStatement(e)?["break"]:ts.isContinueStatement(e)?["continue"]:z(e,3002,"Not implemented: "+ts.SyntaxKind[e.kind]+" ("+e.kind+")");var n,t,r,i,a,o,s,u,l,c,f,p,m,d,y}function N(e){var n=b(e).map(Q);return n.length<1&&(n=[Q("pass")]),n}function x(e){if(e.kind!==ts.SyntaxKind.PropertyDeclaration)return!1;var n=e;if(!n.modifiers||1!==n.modifiers.length)return!1;for(var t=0,r=n.modifiers;t<r.length;t++){var i=r[t];if(i.kind!==ts.SyntaxKind.StaticKeyword)return!1}return!!n.initializer&&n.initializer.kind===ts.SyntaxKind.NumericLiteral}function T(e){switch(e.kind){case ts.SyntaxKind.PropertyDeclaration:return function(e){var n=P(e.name);if(e.initializer){var t=G(e.initializer),r=t[0],i=t[1];return i.concat([n+" = "+L(r)])}return[]}(e);case ts.SyntaxKind.MethodDeclaration:case ts.SyntaxKind.Constructor:return C(e);default:return["# unknown ClassElement "+e.kind]}}function E(e){if(n=e,!ts.isPrefixUnaryExpression(n)&&!ts.isPostfixUnaryExpression(n)||n.operator!==ts.SyntaxKind.MinusMinusToken&&n.operator!==ts.SyntaxKind.PlusPlusToken)return null;var n,t=G(e.operand),r=t[0],i=t[1],a=e.operator===ts.SyntaxKind.MinusMinusToken?" -= 1":" += 1",o=i;return o.push(""+L(r)+a),o}function h(e){var n=e.getChildren().map(g).reduce(function(e,n){return e.concat(n)},[]);return n}function C(e,n,t,r){var i=[];e.kind!==ts.SyntaxKind.MethodDeclaration&&e.kind!==ts.SyntaxKind.Constructor||i.push("self");var a,o,s=t?M(e.parameters,t):e.parameters,u=s.map(function(e){return U(e,!r)}),l=(i=i.concat(u)).join(", "),c=[];if(e.kind===ts.SyntaxKind.Constructor)a="__init__";else if(n)a=n;else{if(!e.name)return z(e,3012,"Unsupported: anonymous function decleration");a=P(e.name)}if(c.push("def "+a+"("+l+"):"),o={vars:{}},y.unshift(o),!e.body)return z(e,3013,"Unsupported: function decleration without body");var f=[];if(ts.isBlock(e.body))f=h(e.body);else{var p=G(e.body),m=p[0],d=p[1];(f=f.concat(d)).concat(m)}return f.length?c=c.concat(f.map(Q)):c.push(Q("pass")),y.shift(),c}function U(e,n){void 0===n&&(n=!0);var t=e.altName||P(e.name),r="";if(e.type&&n){var i=pxtc.emitType(e.type);i&&-1===i.indexOf("(TODO")&&(r=": "+i)}var a="";if(e.initializer){var o=G(e.initializer),s=o[0],u=o[1];if(u.length)return z(e,3007,"TODO: complex expression in parameter default value not supported. Expression: "+e.initializer.getText());a=" = "+L(s)}return""+t+r+a}function I(e){var n=[],t=P(e.name);if(e.initializer){var r=G(e.initializer),i=r[0],a=r[1];n=n.concat(a);var o=void 0;if(e.type){var s=pxtc.emitType(e.type);o=t+": "+s+" = "+L(i)}else o=t+" = "+L(i);return n.push(o),n}return n}function K(e,n){return[[e],n||[]]}function L(e,n){return void 0===n&&(n="\n"),e.join(n)}function F(e,n,t){return void 0===e&&(e=""),void 0===t&&(t=""),n[0]=e+n[0],n[n.length-1]=n[n.length-1]+t,n}function O(e,n){switch(e){case ts.SyntaxKind.BarBarToken:return"or";case ts.SyntaxKind.AmpersandAmpersandToken:return"and";case ts.SyntaxKind.ExclamationToken:return"not";case ts.SyntaxKind.LessThanToken:return"<";case ts.SyntaxKind.LessThanEqualsToken:return"<=";case ts.SyntaxKind.GreaterThanToken:return">";case ts.SyntaxKind.GreaterThanEqualsToken:return">=";case ts.SyntaxKind.EqualsEqualsEqualsToken:case ts.SyntaxKind.EqualsEqualsToken:return"==";case ts.SyntaxKind.ExclamationEqualsEqualsToken:case ts.SyntaxKind.ExclamationEqualsToken:return"!=";case ts.SyntaxKind.EqualsToken:return"=";case ts.SyntaxKind.PlusToken:return"+";case ts.SyntaxKind.MinusToken:return"-";case ts.SyntaxKind.AsteriskToken:return"*";case ts.SyntaxKind.PlusEqualsToken:return"+=";case ts.SyntaxKind.MinusEqualsToken:return"-=";case ts.SyntaxKind.PercentToken:return"%";case ts.SyntaxKind.SlashToken:return"/";case ts.SyntaxKind.PlusPlusToken:case ts.SyntaxKind.MinusMinusToken:return z(n,3008,"Unsupported ++ and -- in an expression (not a statement or for loop)");case ts.SyntaxKind.AmpersandToken:return"&";case ts.SyntaxKind.CaretToken:return"^";case ts.SyntaxKind.LessThanLessThanToken:return"<<";case ts.SyntaxKind.GreaterThanGreaterThanToken:return">>";case ts.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:return z(n,3009,"Unsupported operator: >>>");case ts.SyntaxKind.AsteriskAsteriskToken:return"**";case ts.SyntaxKind.AsteriskAsteriskEqualsToken:return"**=";case ts.SyntaxKind.PercentEqualsToken:return"%=";case ts.SyntaxKind.AsteriskEqualsToken:return"*=";case ts.SyntaxKind.SlashEqualsToken:return"/=";default:return W.tickEvent("depython.todo",{op:e}),z(n,3008,"Unsupported Python operator (code: "+e+")")}}function w(e,n){if(void 0===n&&(n=!1),ts.isPropertyAccessExpression(e)){var t=[P(e.name)];return n&&ts.isIdentifier(e.expression)?t:w(e.expression,n).concat(t)}return ts.isIdentifier(e)?[P(e)]:[]}function D(r){var e=r.join(", ");return 60<e.length?r.map(function(e,n){var t=","==e.charAt(e.length-1)?"":",";return 0==n?e+t:n==r.length-1?Q(e):Q(e+t)}):[e]}function d(e,n,t,r,i){if((ts.isFunctionExpression(e)||ts.isArrowFunction(e))&&n&&n.type&&ts.isFunctionTypeNode(n.type)){var a=void 0,o=function(e,n,t,r){var i="";n&&(i=w(n,!0).map(pxtc.snakify).join("_"));var a=[];if(t&&1<t.length&&r&&1<r.length)for(var o=0;o<t.length&&o<r.length;o++){var s=r[o],u=v.getTypeAtLocation(s);if(k(u,ts.TypeFlags.EnumLike)){var l=w(s,!0).map(pxtc.snakify);a=a.concat(l)}}var c=a.join("_"),f="";i||c||!e||(f=P(e.name));var p=([i,c,f].filter(function(e){return e}).map(pxtc.snakify).map(function(e){return e.toLowerCase()}).join("_")||"my_callback").split("_");4<p.length&&(p=function(e){for(var n={},t=[],r=0,i=e;r<i.length;r++){var a=i[r];a in n||(n[a]=!0,t.push(a))}return t}(p));for(var m=W.U.toDictionary(["any","on","event"],function(e){return e});2<p.length;){var d=y(p,m);if(d.length==p.length)break;p=d}return 1==p.length&&(p=["on",p[0]]),p.join("_");function y(e,n){for(var t=[],r=!1,i=0,a=e;i<a.length;i++){var o=a[i];o in n&&!r?r=!0:t.push(o)}return t}}(n,t,r,i);return B(e,o,a,!0)}return G(e)}function R(r){var e=v.getTypeAtLocation(r.expression),n=v.typeToTypeNode(e),i=ts.createNodeArray([]);if(ts.isFunctionTypeNode(n)&&(i=n.parameters,r.arguments&&i.length<r.arguments.length))return W.tickEvent("depython.todo",{kind:r.kind}),z(r,3010,"TODO: Unsupported call site where caller the arguments outnumber the callee parameters: "+r.getText());var t=G(r.expression),a=t[0],o=t[1],s=L(a),u=r.arguments||ts.createNodeArray(),l=u.map(function(e,n,t){return d(e,i[n],r.expression,i,t)}),c=l.map(function(e){e[0];var n=e[1];return n}).reduce(function(e,n){return e.concat(n)},o);if(0===s.indexOf("_py.py_")){if(l.length<=0)return z(r,3014,"Unsupported: call expression has no arguments for _py.py_ fn");s=s.substr(7).split("_").filter(function(e,n){return 0!==n}).join("_");var f=l.shift()[0],p=D(l.map(function(e){var n=e[0];return e[1],n}).reduce(function(e,n){return e.concat(n)},[]));return[F(f+"."+s+"(",p,")"),c]}var m=D(l.map(function(e){var n=e[0];return e[1],n}).reduce(function(e,n){return e.concat(n)},[]));return[F(s+"(",m,")"),c]}function M(e,n){for(var t=[],r={},i=0;i<Math.max(e.length,n.length);i++){var a=void 0;if(e[i])a=e[i],r[P(a.name)]=!0;else{var o=P((a=n[i]).name);r[o]&&(o=pxtc.decompiler.getNewName(o,r),a=Object.assign({altName:o},n[i]))}t.push(a)}return ts.createNodeArray(t,!1)}function B(e,n,t,r){if(!ts.isBlock(e.body)){var i=G(e.body),a=i[0],o=i[1];if(0===o.length){var s=t?M(e.parameters,t):e.parameters,u=s.map(function(e){return U(e,!1)}).join(", "),l=u.length?"lambda "+u+": "+L(a):"lambda: "+L(a);return K(l)}}var c,f=e.name?P(e.name):("string"!=typeof(c=n||"my_function")&&(c=P(c)),m[c]?pxtc.decompiler.getNewName(c,m):(m[c]=!0,c)),p=C(e,f,t,r);return K(f,p)}function q(e){switch(e){case ts.SyntaxKind.ExclamationToken:return" ";case ts.SyntaxKind.PlusToken:case ts.SyntaxKind.MinusToken:return"";default:return" "}}function G(e){switch(e.kind){case ts.SyntaxKind.BinaryExpression:return function(e){var n=_(e.left),t=_(e.right),r=e.operatorToken.kind===ts.SyntaxKind.PlusToken&&(n||t),i=G(e.left),a=i[0],o=i[1];r&&!n&&(a=F("str(",a,")"));var s=O(e.operatorToken.kind,e),u=G(e.right),l=u[0],c=u[1];r&&!t&&(l=F("str(",l,")"));var f=o.concat(c);return[F(L(a)+" "+s+" ",l),f]}(e);case ts.SyntaxKind.PropertyAccessExpression:return function(e){var n=A(e);if(n)return K(n);var t=G(e.expression),r=t[0],i=t[1],a=P(e.name);return K("length"===a?"len("+L(r)+")":L(r)+"."+a,i)}(e);case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:return R(e);case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:return B(e);case ts.SyntaxKind.PrefixUnaryExpression:return E=O((N=e).operator,N),C=G(N.operand),U=C[0],I=C[1],w=q(N.operator),K(""+E+w+L(U),I);case ts.SyntaxKind.PostfixUnaryExpression:return x=O((g=e).operator,g),T=G(g.operand),h=T[0],S=T[1],b=q(g.operator),K(""+L(h)+b+x,S);case ts.SyntaxKind.ParenthesizedExpression:return y=G(e.expression),v=y[0],k=y[1],K("("+L(v)+")",k);case ts.SyntaxKind.ArrayLiteralExpression:return m=e.elements.map(G),d=m.map(function(e){e[0];var n=e[1];return n}).reduce(function(e,n){return e.concat(n)},[]),[F("[",D(m.map(function(e){var n=e[0];return e[1],n}).reduce(function(e,n){return e.concat(n)},[])),"]"),d];case ts.SyntaxKind.ElementAccessExpression:return function(e){if(!e.argumentExpression)return z(e,3015,"Unsupported: element access expression without an argument expression");var n=G(e.expression),t=n[0],r=n[1],i=G(e.argumentExpression),a=i[0],o=i[1],s=r.concat(o);return K(L(t)+"["+L(a)+"]",s)}(e);case ts.SyntaxKind.NoSubstitutionTemplateLiteral:case ts.SyntaxKind.TaggedTemplateExpression:return function(e){if(ts.isNoSubstitutionTemplateLiteral(e))return K('"""'+e.text+'"""');var n=G(e.tag),t=n[0],r=n[1],i=G(e.template),a=i[0],o=i[1],s=r.concat(o);return K(L(t)+"("+L(a)+")",s)}(e);case ts.SyntaxKind.TrueKeyword:return K("True");case ts.SyntaxKind.FalseKeyword:return K("False");case ts.SyntaxKind.ThisKeyword:return K("self");case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:return K("None");case ts.SyntaxKind.Identifier:return"undefined"==(p=e).text?K("None"):K(P(p));case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:return K(e.getText());case ts.SyntaxKind.ConditionalExpression:return t=G((n=e).condition),r=t[0],i=t[1],a=G(n.whenTrue),o=a[0],s=a[1],u=G(n.whenFalse),l=u[0],c=u[1],f=i.concat(s).concat(c),K(o+" if "+L(r)+" else "+L(l),f);default:return K(e.getText(),["# unknown expression:  "+e.kind])}var n,t,r,i,a,o,s,u,l,c,f,p,m,d,y,v,k,g,x,T,h,S,b,N,E,C,U,I,w}}(e,n),i=n.replace(/(\.py)?\.\w*$/i,"")+".py";t.outfiles[i]=r}catch(e){e.pyDiagnostic?t.diagnostics=[e.pyDiagnostic]:W.reportException(e),t.success=!1}return t},n.INDENT="    ";var t,Q=(t=1,function(e){return""+n.INDENT.repeat(t)+e})}(W.py||(W.py={}))}(pxt||(pxt={})),function(e){var n,t,r;n=e.py||(e.py={}),t=n.rx||(n.rx={}),r=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,t.isIdentifierStart=function(e){return ts.pxtc.isIdentifierStart(e,ts.pxtc.ScriptTarget.ES5)},t.isIdentifierChar=function(e){return ts.pxtc.isIdentifierPart(e,ts.pxtc.ScriptTarget.ES5)},t.isSpace=function(e){return!!(32===e||9===e||11===e||12===e||160===e||5760<=e&&r.test(String.fromCharCode(e)))},t.isNewline=function(e){return 10===e||13===e||8232===e||8233===e}}(pxt||(pxt={}));